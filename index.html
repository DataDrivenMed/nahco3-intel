<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>NaHCO‚ÇÉ ‚Äî Elite Swimming Intelligence</title>
<style>
@import url('https://fonts.googleapis.com/css2?family=DM+Serif+Display:ital@0;1&family=DM+Mono:wght@300;400;500&family=Instrument+Sans:wght@400;500;600&display=swap');

:root {
  --bg: #080c10;
  --surface: #0d1218;
  --surface2: #131b24;
  --border: rgba(255,255,255,0.07);
  --accent: #00d4ff;
  --accent2: #ff6b35;
  --accent3: #a8ff78;
  --text: #e8edf2;
  --text-dim: #6b7d8f;
  --text-mid: #9aacbc;
  --danger: #ff4757;
  --warning: #ffd32a;
}

*, *::before, *::after { box-sizing: border-box; margin: 0; padding: 0; }

html { scroll-behavior: smooth; }

body {
  background: var(--bg);
  color: var(--text);
  font-family: 'Instrument Sans', sans-serif;
  min-height: 100vh;
  overflow-x: hidden;
  cursor: default;
}

/* ‚îÄ‚îÄ BACKGROUND GRID ‚îÄ‚îÄ */
body::before {
  content: '';
  position: fixed;
  inset: 0;
  background-image:
    linear-gradient(rgba(0,212,255,0.03) 1px, transparent 1px),
    linear-gradient(90deg, rgba(0,212,255,0.03) 1px, transparent 1px);
  background-size: 40px 40px;
  pointer-events: none;
  z-index: 0;
}

/* ‚îÄ‚îÄ SPLASH ‚îÄ‚îÄ */
#splash {
  position: fixed;
  inset: 0;
  background: var(--bg);
  display: flex;
  align-items: center;
  justify-content: center;
  flex-direction: column;
  gap: 24px;
  z-index: 1000;
  transition: opacity 0.8s ease, transform 0.8s ease;
}
#splash.out { opacity: 0; transform: scale(0.97); pointer-events: none; }

.splash-formula {
  font-family: 'DM Serif Display', serif;
  font-size: clamp(48px, 8vw, 96px);
  color: var(--accent);
  letter-spacing: -2px;
  animation: glow 3s ease-in-out infinite;
}
@keyframes glow {
  0%,100% { text-shadow: 0 0 20px rgba(0,212,255,0.3), 0 0 60px rgba(0,212,255,0.1); }
  50% { text-shadow: 0 0 40px rgba(0,212,255,0.6), 0 0 100px rgba(0,212,255,0.3); }
}
.splash-sub {
  font-family: 'DM Mono', monospace;
  font-size: 13px;
  color: var(--text-dim);
  letter-spacing: 4px;
  text-transform: uppercase;
}
.splash-enter {
  margin-top: 16px;
  padding: 14px 40px;
  background: transparent;
  border: 1px solid var(--accent);
  color: var(--accent);
  font-family: 'DM Mono', monospace;
  font-size: 12px;
  letter-spacing: 3px;
  text-transform: uppercase;
  cursor: pointer;
  transition: all 0.3s;
  position: relative;
  overflow: hidden;
}
.splash-enter::before {
  content: '';
  position: absolute;
  inset: 0;
  background: var(--accent);
  transform: translateX(-100%);
  transition: transform 0.3s ease;
  z-index: -1;
}
.splash-enter:hover { color: var(--bg); }
.splash-enter:hover::before { transform: translateX(0); }

/* ‚îÄ‚îÄ LAYOUT ‚îÄ‚îÄ */
#app { position: relative; z-index: 1; display: none; }
#app.visible { display: block; }

/* ‚îÄ‚îÄ HEADER ‚îÄ‚îÄ */
header {
  position: sticky;
  top: 0;
  z-index: 100;
  background: rgba(8,12,16,0.92);
  backdrop-filter: blur(20px);
  border-bottom: 1px solid var(--border);
  padding: 0 32px;
  display: flex;
  align-items: center;
  justify-content: space-between;
  height: 72px;
  gap: 16px;
}
.logo {
  font-family: 'DM Mono', monospace;
  font-size: 14px;
  color: var(--accent);
  letter-spacing: 2px;
  white-space: nowrap;
  flex-shrink: 0;
}
nav {
  display: flex;
  gap: 2px;
  flex-wrap: wrap;
  align-items: center;
}
.nav-btn {
  padding: 9px 15px;
  background: none;
  border: none;
  color: var(--text-mid);
  font-family: 'Instrument Sans', sans-serif;
  font-size: 13px;
  font-weight: 500;
  letter-spacing: 0.3px;
  cursor: pointer;
  transition: all 0.2s;
  border-radius: 6px;
  white-space: nowrap;
}
.nav-btn:hover { color: var(--text); background: var(--surface); }
.nav-btn.active {
  color: var(--accent);
  background: rgba(0,212,255,0.1);
  box-shadow: inset 0 -2px 0 var(--accent);
}
.nav-btn.substack-btn {
  color: #ff6314;
  border: 1px solid rgba(255,99,20,0.3);
  background: rgba(255,99,20,0.06);
  font-weight: 600;
  margin-left: 8px;
}
.nav-btn.substack-btn:hover {
  background: rgba(255,99,20,0.14);
  border-color: rgba(255,99,20,0.6);
  color: #ff7a35;
}
a.nav-btn { text-decoration: none; display: inline-flex; align-items: center; gap: 6px; }

/* ‚îÄ‚îÄ SECTIONS ‚îÄ‚îÄ */
.section {
  display: none;
  animation: fadeIn 0.5s ease;
  min-height: calc(100vh - 60px);
}
.section.active { display: block; }
@keyframes fadeIn {
  from { opacity: 0; transform: translateY(16px); }
  to { opacity: 1; transform: translateY(0); }
}

/* ‚îÄ‚îÄ HERO (OVERVIEW) ‚îÄ‚îÄ */
.hero {
  padding: 80px 48px 48px;
  max-width: 1200px;
  margin: 0 auto;
}
.hero-eyebrow {
  font-family: 'DM Mono', monospace;
  font-size: 11px;
  letter-spacing: 4px;
  color: var(--accent);
  text-transform: uppercase;
  margin-bottom: 20px;
}
.hero-title {
  font-family: 'DM Serif Display', serif;
  font-size: clamp(36px, 5vw, 72px);
  line-height: 1.1;
  color: var(--text);
  margin-bottom: 24px;
}
.hero-title em {
  font-style: italic;
  color: var(--accent);
}
.hero-lead {
  font-size: 16px;
  line-height: 1.8;
  color: var(--text-mid);
  max-width: 680px;
  margin-bottom: 56px;
}

/* ‚îÄ‚îÄ STAT CARDS ‚îÄ‚îÄ */
.stat-grid {
  display: grid;
  grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
  gap: 16px;
  margin-bottom: 64px;
}
.stat-card {
  background: var(--surface);
  border: 1px solid var(--border);
  border-radius: 8px;
  padding: 24px;
  position: relative;
  overflow: hidden;
  transition: all 0.3s ease;
  cursor: default;
}
.stat-card::before {
  content: '';
  position: absolute;
  top: 0; left: 0; right: 0;
  height: 2px;
  background: var(--card-accent, var(--accent));
  transform: scaleX(0);
  transform-origin: left;
  transition: transform 0.3s ease;
}
.stat-card:hover { border-color: rgba(255,255,255,0.15); transform: translateY(-2px); }
.stat-card:hover::before { transform: scaleX(1); }
.stat-num {
  font-family: 'DM Serif Display', serif;
  font-size: 42px;
  line-height: 1;
  margin-bottom: 8px;
  color: var(--card-accent, var(--accent));
}
.stat-label {
  font-family: 'DM Mono', monospace;
  font-size: 11px;
  letter-spacing: 1.5px;
  color: var(--text-dim);
  text-transform: uppercase;
}
.stat-sub {
  font-size: 12px;
  color: var(--text-dim);
  margin-top: 6px;
  line-height: 1.4;
}

/* ‚îÄ‚îÄ MECHANISM VISUALIZATION ‚îÄ‚îÄ */
.mechanism-viz {
  background: var(--surface);
  border: 1px solid var(--border);
  border-radius: 12px;
  padding: 40px;
  margin-bottom: 48px;
}
.mech-title {
  font-family: 'DM Mono', monospace;
  font-size: 11px;
  letter-spacing: 3px;
  color: var(--accent);
  text-transform: uppercase;
  margin-bottom: 32px;
}
.mech-flow {
  display: flex;
  align-items: center;
  gap: 0;
  flex-wrap: wrap;
}
.mech-step {
  flex: 1;
  min-width: 140px;
  text-align: center;
  padding: 20px 16px;
  position: relative;
}
.mech-icon {
  font-size: 28px;
  margin-bottom: 12px;
  display: block;
}
.mech-step-title {
  font-family: 'DM Mono', monospace;
  font-size: 10px;
  letter-spacing: 1.5px;
  color: var(--accent);
  text-transform: uppercase;
  margin-bottom: 6px;
}
.mech-step-text {
  font-size: 12px;
  color: var(--text-dim);
  line-height: 1.5;
}
.mech-arrow {
  font-size: 20px;
  color: var(--border);
  flex-shrink: 0;
  padding: 0 8px;
  animation: pulse-arrow 2s ease-in-out infinite;
}
@keyframes pulse-arrow {
  0%,100% { color: rgba(0,212,255,0.2); }
  50% { color: rgba(0,212,255,0.6); }
}

/* ‚îÄ‚îÄ CONTENT GRID ‚îÄ‚îÄ */
.content-grid {
  display: grid;
  grid-template-columns: 1fr 1fr;
  gap: 24px;
  max-width: 1200px;
  margin: 0 auto;
  padding: 0 48px 80px;
}
@media (max-width: 768px) { .content-grid { grid-template-columns: 1fr; } }
.content-card {
  background: var(--surface);
  border: 1px solid var(--border);
  border-radius: 8px;
  padding: 28px;
}
.content-card h3 {
  font-family: 'DM Serif Display', serif;
  font-size: 22px;
  margin-bottom: 16px;
  color: var(--text);
}
.content-card p {
  font-size: 14px;
  line-height: 1.8;
  color: var(--text-mid);
  margin-bottom: 12px;
}
.content-card p:last-child { margin-bottom: 0; }

/* ‚îÄ‚îÄ EVIDENCE SECTION ‚îÄ‚îÄ */
.evidence-wrap {
  max-width: 1200px;
  margin: 0 auto;
  padding: 64px 48px;
}
.section-header {
  margin-bottom: 48px;
}
.section-eyebrow {
  font-family: 'DM Mono', monospace;
  font-size: 11px;
  letter-spacing: 4px;
  color: var(--accent);
  text-transform: uppercase;
  margin-bottom: 12px;
}
.section-title {
  font-family: 'DM Serif Display', serif;
  font-size: clamp(28px, 4vw, 48px);
  line-height: 1.15;
}
.section-desc {
  margin-top: 16px;
  font-size: 15px;
  color: var(--text-mid);
  max-width: 600px;
  line-height: 1.7;
}

/* ‚îÄ‚îÄ DEBATE CARDS ‚îÄ‚îÄ */
.debate-container {
  display: grid;
  grid-template-columns: 1fr 1fr;
  gap: 2px;
  border-radius: 12px;
  overflow: hidden;
  margin-bottom: 32px;
}
.debate-side {
  padding: 32px;
  background: var(--surface);
}
.debate-side.pro { border-left: 3px solid var(--accent3); }
.debate-side.con { border-left: 3px solid var(--danger); }
.debate-label {
  font-family: 'DM Mono', monospace;
  font-size: 10px;
  letter-spacing: 3px;
  text-transform: uppercase;
  margin-bottom: 20px;
}
.debate-side.pro .debate-label { color: var(--accent3); }
.debate-side.con .debate-label { color: var(--danger); }
.debate-item {
  display: flex;
  gap: 12px;
  margin-bottom: 20px;
  animation: slideIn 0.4s ease both;
}
.debate-dot {
  width: 6px;
  height: 6px;
  border-radius: 50%;
  flex-shrink: 0;
  margin-top: 7px;
}
.pro .debate-dot { background: var(--accent3); }
.con .debate-dot { background: var(--danger); }
.debate-text {
  font-size: 13px;
  line-height: 1.7;
  color: var(--text-mid);
}
.debate-text strong { color: var(--text); font-weight: 600; }

/* ‚îÄ‚îÄ PROTOCOL SECTION ‚îÄ‚îÄ */
.protocol-wrap {
  max-width: 1200px;
  margin: 0 auto;
  padding: 64px 48px;
}
.protocol-timeline {
  position: relative;
  padding-left: 32px;
  margin-bottom: 48px;
}
.protocol-timeline::before {
  content: '';
  position: absolute;
  left: 8px;
  top: 8px;
  bottom: 8px;
  width: 1px;
  background: linear-gradient(to bottom, var(--accent), rgba(0,212,255,0.1));
}
.timeline-item {
  position: relative;
  margin-bottom: 32px;
  padding: 24px 28px;
  background: var(--surface);
  border: 1px solid var(--border);
  border-radius: 8px;
  transition: all 0.3s;
}
.timeline-item:hover { border-color: rgba(0,212,255,0.3); transform: translateX(4px); }
.timeline-dot {
  position: absolute;
  left: -36px;
  top: 50%;
  transform: translateY(-50%);
  width: 16px;
  height: 16px;
  border-radius: 50%;
  background: var(--bg);
  border: 2px solid var(--accent);
  box-shadow: 0 0 12px rgba(0,212,255,0.4);
}
.timeline-time {
  font-family: 'DM Mono', monospace;
  font-size: 11px;
  letter-spacing: 2px;
  color: var(--accent);
  text-transform: uppercase;
  margin-bottom: 8px;
}
.timeline-title {
  font-size: 16px;
  font-weight: 600;
  margin-bottom: 6px;
}
.timeline-desc {
  font-size: 13px;
  color: var(--text-dim);
  line-height: 1.6;
}

/* ‚îÄ‚îÄ DOSING CALCULATOR ‚îÄ‚îÄ */
.calc-card {
  background: var(--surface);
  border: 1px solid var(--border);
  border-radius: 12px;
  padding: 36px;
  margin-bottom: 32px;
}
.calc-title {
  font-family: 'DM Mono', monospace;
  font-size: 11px;
  letter-spacing: 3px;
  text-transform: uppercase;
  color: var(--accent);
  margin-bottom: 24px;
}
.calc-row {
  display: grid;
  grid-template-columns: 1fr 1fr;
  gap: 24px;
  margin-bottom: 24px;
}
.calc-field label {
  display: block;
  font-family: 'DM Mono', monospace;
  font-size: 10px;
  letter-spacing: 2px;
  color: var(--text-dim);
  text-transform: uppercase;
  margin-bottom: 10px;
}
.calc-field input, .calc-field select {
  width: 100%;
  background: var(--bg);
  border: 1px solid var(--border);
  border-radius: 4px;
  padding: 12px 16px;
  color: var(--text);
  font-family: 'DM Mono', monospace;
  font-size: 14px;
  transition: border-color 0.2s;
  outline: none;
  appearance: none;
}
.calc-field input:focus, .calc-field select:focus {
  border-color: var(--accent);
  box-shadow: 0 0 0 3px rgba(0,212,255,0.08);
}
.calc-result {
  background: rgba(0,212,255,0.06);
  border: 1px solid rgba(0,212,255,0.2);
  border-radius: 8px;
  padding: 24px;
  display: grid;
  grid-template-columns: repeat(3, 1fr);
  gap: 16px;
  margin-top: 8px;
}
.result-item { text-align: center; }
.result-num {
  font-family: 'DM Serif Display', serif;
  font-size: 32px;
  color: var(--accent);
  display: block;
  line-height: 1;
  margin-bottom: 4px;
}
.result-label {
  font-family: 'DM Mono', monospace;
  font-size: 10px;
  letter-spacing: 1.5px;
  color: var(--text-dim);
  text-transform: uppercase;
}
.risk-bar {
  margin-top: 20px;
  padding: 16px 20px;
  border-radius: 6px;
  font-size: 13px;
  line-height: 1.6;
}
.risk-low { background: rgba(168,255,120,0.08); border: 1px solid rgba(168,255,120,0.2); color: var(--accent3); }
.risk-med { background: rgba(255,211,42,0.08); border: 1px solid rgba(255,211,42,0.2); color: var(--warning); }
.risk-high { background: rgba(255,71,87,0.08); border: 1px solid rgba(255,71,87,0.2); color: var(--danger); }

/* ‚îÄ‚îÄ DISTANCE MATRIX ‚îÄ‚îÄ */
.matrix-grid {
  display: grid;
  grid-template-columns: repeat(5, 1fr);
  gap: 8px;
  margin-bottom: 16px;
}
.matrix-cell {
  padding: 16px 8px;
  border-radius: 6px;
  text-align: center;
  font-family: 'DM Mono', monospace;
  font-size: 11px;
  letter-spacing: 1px;
  cursor: pointer;
  transition: all 0.2s;
  position: relative;
  overflow: hidden;
}
.matrix-cell::after {
  content: '';
  position: absolute;
  inset: 0;
  opacity: 0;
  transition: opacity 0.2s;
}
.matrix-cell:hover::after { opacity: 0.1; }
.matrix-none { background: rgba(255,71,87,0.1); border: 1px solid rgba(255,71,87,0.2); color: var(--danger); }
.matrix-low { background: rgba(255,211,42,0.08); border: 1px solid rgba(255,211,42,0.2); color: var(--warning); }
.matrix-high { background: rgba(168,255,120,0.08); border: 1px solid rgba(168,255,120,0.2); color: var(--accent3); }
.matrix-none::after { background: var(--danger); }
.matrix-low::after { background: var(--warning); }
.matrix-high::after { background: var(--accent3); }
.matrix-label { font-size: 13px; margin-bottom: 4px; font-weight: 600; }
.matrix-sub { font-size: 9px; color: inherit; opacity: 0.7; }
.matrix-detail {
  padding: 20px 24px;
  background: var(--surface);
  border: 1px solid var(--border);
  border-radius: 8px;
  font-size: 13px;
  color: var(--text-mid);
  line-height: 1.7;
  min-height: 80px;
  transition: all 0.3s;
}

/* ‚îÄ‚îÄ RESEARCHERS ‚îÄ‚îÄ */
.researcher-grid {
  display: grid;
  grid-template-columns: repeat(auto-fill, minmax(280px, 1fr));
  gap: 16px;
}
.researcher-card {
  background: var(--surface);
  border: 1px solid var(--border);
  border-radius: 8px;
  padding: 24px;
  cursor: pointer;
  transition: all 0.3s;
  position: relative;
  overflow: hidden;
}
.researcher-card::before {
  content: '';
  position: absolute;
  inset: 0;
  background: linear-gradient(135deg, rgba(0,212,255,0.05), transparent);
  opacity: 0;
  transition: opacity 0.3s;
}
.researcher-card:hover { border-color: rgba(0,212,255,0.3); transform: translateY(-2px); }
.researcher-card:hover::before { opacity: 1; }
.researcher-name {
  font-family: 'DM Serif Display', serif;
  font-size: 20px;
  margin-bottom: 4px;
}
.researcher-inst {
  font-family: 'DM Mono', monospace;
  font-size: 10px;
  letter-spacing: 1px;
  color: var(--accent);
  text-transform: uppercase;
  margin-bottom: 12px;
}
.researcher-stance {
  display: inline-block;
  padding: 3px 10px;
  border-radius: 20px;
  font-size: 10px;
  letter-spacing: 1px;
  text-transform: uppercase;
  font-family: 'DM Mono', monospace;
  margin-bottom: 14px;
}
.stance-pro { background: rgba(168,255,120,0.1); color: var(--accent3); border: 1px solid rgba(168,255,120,0.2); }
.stance-nuanced { background: rgba(0,212,255,0.1); color: var(--accent); border: 1px solid rgba(0,212,255,0.2); }
.stance-skeptical { background: rgba(255,211,42,0.1); color: var(--warning); border: 1px solid rgba(255,211,42,0.2); }
.researcher-bio {
  font-size: 12px;
  color: var(--text-dim);
  line-height: 1.6;
  display: -webkit-box;
  -webkit-line-clamp: 3;
  -webkit-box-orient: vertical;
  overflow: hidden;
}
.researcher-card.expanded .researcher-bio {
  display: block;
  -webkit-line-clamp: unset;
}
.expand-btn {
  margin-top: 12px;
  font-family: 'DM Mono', monospace;
  font-size: 10px;
  letter-spacing: 1px;
  color: var(--accent);
  background: none;
  border: none;
  cursor: pointer;
  text-transform: uppercase;
  padding: 0;
}

/* ‚îÄ‚îÄ GAPS & UNKNOWNS ‚îÄ‚îÄ */
.gaps-grid {
  display: grid;
  grid-template-columns: 1fr 1fr;
  gap: 16px;
}
.gap-card {
  background: var(--surface);
  border: 1px solid var(--border);
  border-radius: 8px;
  padding: 24px;
  position: relative;
  overflow: hidden;
  transition: all 0.3s;
}
.gap-card:hover { border-color: rgba(255,107,53,0.4); transform: translateY(-2px); }
.gap-card::before {
  content: '';
  position: absolute;
  top: 0; left: 0; right: 0;
  height: 2px;
  background: var(--accent2);
  transform: scaleX(0);
  transform-origin: left;
  transition: transform 0.3s;
}
.gap-card:hover::before { transform: scaleX(1); }
.gap-icon { font-size: 24px; margin-bottom: 12px; }
.gap-title {
  font-family: 'DM Serif Display', serif;
  font-size: 18px;
  margin-bottom: 10px;
}
.gap-text {
  font-size: 13px;
  color: var(--text-dim);
  line-height: 1.7;
}

/* ‚îÄ‚îÄ COACH FRAMEWORK ‚îÄ‚îÄ */
.framework-wrap {
  max-width: 1200px;
  margin: 0 auto;
  padding: 64px 48px;
}
.decision-tree {
  background: var(--surface);
  border: 1px solid var(--border);
  border-radius: 12px;
  padding: 36px;
  margin-bottom: 32px;
}
.tree-question {
  font-family: 'DM Serif Display', serif;
  font-size: 22px;
  margin-bottom: 16px;
  color: var(--text);
}
.tree-options {
  display: grid;
  grid-template-columns: 1fr 1fr;
  gap: 12px;
  margin-top: 16px;
}
.tree-option {
  padding: 16px 20px;
  border: 1px solid var(--border);
  border-radius: 6px;
  cursor: pointer;
  transition: all 0.2s;
  font-size: 13px;
  color: var(--text-mid);
  background: var(--bg);
}
.tree-option:hover { border-color: var(--accent); color: var(--text); background: rgba(0,212,255,0.05); }
.tree-option.selected { border-color: var(--accent); color: var(--accent); background: rgba(0,212,255,0.08); }
.tree-result {
  margin-top: 20px;
  padding: 20px 24px;
  border-radius: 8px;
  font-size: 14px;
  line-height: 1.7;
  display: none;
  animation: fadeIn 0.4s ease;
}
.result-proceed { background: rgba(168,255,120,0.08); border: 1px solid rgba(168,255,120,0.25); color: var(--accent3); }
.result-caution { background: rgba(255,211,42,0.08); border: 1px solid rgba(255,211,42,0.25); color: var(--warning); }
.result-stop { background: rgba(255,71,87,0.08); border: 1px solid rgba(255,71,87,0.25); color: var(--danger); }

/* ‚îÄ‚îÄ KEY PRINCIPLES ‚îÄ‚îÄ */
.principles-list {
  counter-reset: principle;
}
.principle-item {
  display: flex;
  gap: 24px;
  padding: 28px 0;
  border-bottom: 1px solid var(--border);
  counter-increment: principle;
  align-items: flex-start;
}
.principle-item:last-child { border-bottom: none; }
.principle-num {
  font-family: 'DM Serif Display', serif;
  font-size: 48px;
  color: rgba(0,212,255,0.15);
  line-height: 1;
  flex-shrink: 0;
  width: 60px;
  text-align: right;
}
.principle-content {}
.principle-title {
  font-family: 'DM Serif Display', serif;
  font-size: 22px;
  margin-bottom: 10px;
}
.principle-text {
  font-size: 14px;
  color: var(--text-mid);
  line-height: 1.8;
}

/* ‚îÄ‚îÄ TABS ‚îÄ‚îÄ */
.tab-bar {
  display: flex;
  gap: 0;
  border-bottom: 1px solid var(--border);
  margin-bottom: 32px;
}
.tab-btn {
  padding: 12px 24px;
  background: none;
  border: none;
  border-bottom: 2px solid transparent;
  color: var(--text-dim);
  font-family: 'DM Mono', monospace;
  font-size: 11px;
  letter-spacing: 2px;
  text-transform: uppercase;
  cursor: pointer;
  transition: all 0.2s;
  margin-bottom: -1px;
}
.tab-btn:hover { color: var(--text); }
.tab-btn.active { color: var(--accent); border-bottom-color: var(--accent); }
.tab-content { display: none; animation: fadeIn 0.3s ease; }
.tab-content.active { display: block; }

/* ‚îÄ‚îÄ QUOTE BLOCK ‚îÄ‚îÄ */
.insight-block {
  border-left: 3px solid var(--accent);
  padding: 20px 24px;
  background: rgba(0,212,255,0.04);
  border-radius: 0 6px 6px 0;
  margin: 24px 0;
}
.insight-text {
  font-family: 'DM Serif Display', serif;
  font-style: italic;
  font-size: 18px;
  line-height: 1.6;
  color: var(--text);
  margin-bottom: 10px;
}
.insight-source {
  font-family: 'DM Mono', monospace;
  font-size: 10px;
  letter-spacing: 2px;
  color: var(--text-dim);
  text-transform: uppercase;
}

/* ‚îÄ‚îÄ SCROLLBAR ‚îÄ‚îÄ */
::-webkit-scrollbar { width: 4px; }
::-webkit-scrollbar-track { background: var(--bg); }
::-webkit-scrollbar-thumb { background: var(--border); border-radius: 2px; }

/* ‚îÄ‚îÄ UTILITY ‚îÄ‚îÄ */
.tag {
  display: inline-block;
  padding: 3px 10px;
  border-radius: 20px;
  font-family: 'DM Mono', monospace;
  font-size: 10px;
  letter-spacing: 1px;
  text-transform: uppercase;
  margin-right: 6px;
  margin-bottom: 6px;
}
.tag-blue { background: rgba(0,212,255,0.1); color: var(--accent); border: 1px solid rgba(0,212,255,0.2); }
.tag-orange { background: rgba(255,107,53,0.1); color: var(--accent2); border: 1px solid rgba(255,107,53,0.2); }
.tag-green { background: rgba(168,255,120,0.1); color: var(--accent3); border: 1px solid rgba(168,255,120,0.2); }
.tag-red { background: rgba(255,71,87,0.1); color: var(--danger); border: 1px solid rgba(255,71,87,0.2); }

.divider { height: 1px; background: var(--border); margin: 48px 0; }

@keyframes slideIn {
  from { opacity: 0; transform: translateX(-12px); }
  to { opacity: 1; transform: translateX(0); }
}

/* ‚îÄ‚îÄ TOOLTIP ‚îÄ‚îÄ */
.tooltip-wrap { position: relative; display: inline-block; }
.tooltip-wrap .tt {
  position: absolute;
  bottom: calc(100% + 8px);
  left: 50%;
  transform: translateX(-50%);
  background: #1a2535;
  border: 1px solid var(--border);
  border-radius: 6px;
  padding: 10px 14px;
  font-size: 12px;
  color: var(--text-mid);
  white-space: nowrap;
  pointer-events: none;
  opacity: 0;
  transition: opacity 0.2s;
  z-index: 50;
}
.tooltip-wrap:hover .tt { opacity: 1; }

/* ‚îÄ‚îÄ PROGRESS BAR ‚îÄ‚îÄ */
.evidence-bar-wrap { margin-bottom: 16px; }
.evidence-bar-label {
  display: flex;
  justify-content: space-between;
  margin-bottom: 6px;
  font-size: 12px;
  color: var(--text-mid);
}
.evidence-bar-label span:last-child {
  font-family: 'DM Mono', monospace;
  font-size: 11px;
  color: var(--accent);
}
.evidence-bar-track {
  height: 4px;
  background: var(--surface2);
  border-radius: 2px;
  overflow: hidden;
}
.evidence-bar-fill {
  height: 100%;
  border-radius: 2px;
  transition: width 1.2s cubic-bezier(0.4, 0, 0.2, 1);
  width: 0;
}
.evidence-bar-fill.animate { width: var(--w); }

/* ‚îÄ‚îÄ GI RISK METER ‚îÄ‚îÄ */
.meter-track {
  height: 12px;
  background: linear-gradient(to right, var(--accent3), var(--warning), var(--danger));
  border-radius: 6px;
  position: relative;
  margin: 16px 0 8px;
}
.meter-needle {
  position: absolute;
  top: 50%;
  transform: translate(-50%, -50%);
  width: 4px;
  height: 20px;
  background: white;
  border-radius: 2px;
  box-shadow: 0 0 8px rgba(255,255,255,0.8);
  transition: left 0.6s cubic-bezier(0.34, 1.56, 0.64, 1);
}
.meter-labels {
  display: flex;
  justify-content: space-between;
  font-family: 'DM Mono', monospace;
  font-size: 9px;
  letter-spacing: 1px;
  color: var(--text-dim);
  text-transform: uppercase;
}

/* ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
   INTERACTIVE MODELS ‚Äî styles
‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê */
/* ‚îÄ‚îÄ MODEL CONTAINER ‚îÄ‚îÄ */
.model-block {
  margin-bottom: 80px;
}
.model-label {
  font-family: 'DM Mono', monospace;
  font-size: 10px;
  letter-spacing: 4px;
  text-transform: uppercase;
  color: var(--text-dim);
  margin-bottom: 12px;
}
.model-title {
  font-family: 'DM Serif Display', serif;
  font-size: clamp(28px, 3vw, 42px);
  line-height: 1.15;
  margin-bottom: 8px;
}
.model-desc {
  font-size: 14px;
  color: var(--text-mid);
  line-height: 1.7;
  max-width: 700px;
  margin-bottom: 32px;
}

/* ‚îÄ‚îÄ PANELS ‚îÄ‚îÄ */
.panel {
  background: var(--surface);
  border: 1px solid var(--border);
  border-radius: 16px;
  overflow: hidden;
}
.panel-header {
  display: flex;
  align-items: center;
  gap: 12px;
  padding: 20px 28px;
  border-bottom: 1px solid var(--border);
  background: var(--surface2);
}
.panel-dot { width: 8px; height: 8px; border-radius: 50%; }
.panel-dot.cyan { background: var(--accent); box-shadow: 0 0 8px var(--accent); }
.panel-dot.orange { background: var(--accent2); box-shadow: 0 0 8px var(--accent2); }
.panel-dot.green { background: var(--accent3); box-shadow: 0 0 8px var(--accent3); }
.panel-title {
  font-family: 'DM Mono', monospace;
  font-size: 11px;
  letter-spacing: 2px;
  text-transform: uppercase;
  color: var(--text-mid);
  flex: 1;
}
.panel-body { padding: 28px; }

/* ‚îÄ‚îÄ LAYER TABS ‚îÄ‚îÄ */
.layer-tabs {
  display: flex;
  gap: 4px;
  background: var(--bg);
  border: 1px solid var(--border);
  border-radius: 10px;
  padding: 4px;
  margin-bottom: 28px;
  flex-wrap: wrap;
}
.layer-tab {
  flex: 1;
  min-width: 120px;
  padding: 10px 16px;
  background: transparent;
  border: none;
  border-radius: 7px;
  color: var(--text-dim);
  font-family: 'DM Mono', monospace;
  font-size: 11px;
  letter-spacing: 1px;
  text-transform: uppercase;
  cursor: pointer;
  transition: all 0.2s;
  white-space: nowrap;
}
.layer-tab:hover { color: var(--text); background: var(--surface2); }
.layer-tab.active { background: rgba(0,212,255,0.12); color: var(--accent); }
.layer-tab.orange.active { background: rgba(255,107,53,0.12); color: var(--accent2); }
.layer-tab.green.active { background: rgba(168,255,120,0.12); color: var(--accent3); }
.layer-tab.purple.active { background: rgba(192,132,252,0.12); color: var(--purple); }

.layer-content { display: none; }
.layer-content.active { display: block; }

/* ‚îÄ‚îÄ CANVAS WRAPPER ‚îÄ‚îÄ */
.canvas-wrap {
  position: relative;
  width: 100%;
  height: 340px;
  background: var(--bg);
  border: 1px solid var(--border);
  border-radius: 10px;
  overflow: hidden;
  margin-bottom: 20px;
}
canvas { display: block; }

/* ‚îÄ‚îÄ CONTROLS ‚îÄ‚îÄ */
.ctrl-row {
  display: flex;
  align-items: center;
  gap: 20px;
  flex-wrap: wrap;
  margin-bottom: 16px;
}
.ctrl-group {
  display: flex;
  flex-direction: column;
  gap: 6px;
  flex: 1;
  min-width: 160px;
}
.ctrl-label {
  font-family: 'DM Mono', monospace;
  font-size: 10px;
  letter-spacing: 2px;
  text-transform: uppercase;
  color: var(--text-dim);
}
.ctrl-value {
  font-family: 'DM Mono', monospace;
  font-size: 13px;
  color: var(--accent);
}
input[type=range] {
  -webkit-appearance: none;
  width: 100%;
  height: 4px;
  background: var(--surface3);
  border-radius: 2px;
  outline: none;
}
input[type=range]::-webkit-slider-thumb {
  -webkit-appearance: none;
  width: 14px; height: 14px;
  border-radius: 50%;
  background: var(--accent);
  cursor: pointer;
  box-shadow: 0 0 8px rgba(0,212,255,0.5);
}
input[type=range].orange::-webkit-slider-thumb { background: var(--accent2); box-shadow: 0 0 8px rgba(255,107,53,0.5); }
input[type=range].green::-webkit-slider-thumb { background: var(--accent3); box-shadow: 0 0 8px rgba(168,255,120,0.5); }

select {
  background: var(--surface2);
  border: 1px solid var(--border2);
  border-radius: 6px;
  color: var(--text);
  font-family: 'DM Mono', monospace;
  font-size: 12px;
  padding: 8px 12px;
  cursor: pointer;
  outline: none;
}

/* ‚îÄ‚îÄ INFO BOXES ‚îÄ‚îÄ */
.info-grid {
  display: grid;
  grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
  gap: 12px;
  margin-top: 20px;
}
.info-card {
  background: var(--surface2);
  border: 1px solid var(--border);
  border-radius: 10px;
  padding: 16px;
}
.info-card-label {
  font-family: 'DM Mono', monospace;
  font-size: 10px;
  letter-spacing: 2px;
  color: var(--text-dim);
  text-transform: uppercase;
  margin-bottom: 6px;
}
.info-card-value {
  font-family: 'DM Serif Display', serif;
  font-size: 22px;
  color: var(--accent);
  margin-bottom: 4px;
}
.info-card-value.orange { color: var(--accent2); }
.info-card-value.green { color: var(--accent3); }
.info-card-value.danger { color: var(--danger); }
.info-card-sub { font-size: 12px; color: var(--text-dim); line-height: 1.5; }

/* ‚îÄ‚îÄ MECHANISM DIAGRAM ‚îÄ‚îÄ */
.mech-diagram {
  display: flex;
  gap: 0;
  align-items: stretch;
  height: 300px;
  border: 1px solid var(--border);
  border-radius: 10px;
  overflow: hidden;
  margin-bottom: 20px;
}
.mech-zone {
  flex: 1;
  display: flex;
  flex-direction: column;
  align-items: center;
  justify-content: center;
  padding: 20px 12px;
  position: relative;
  border-right: 1px solid var(--border);
  transition: background 0.3s;
}
.mech-zone:last-child { border-right: none; }
.mech-zone:hover { background: var(--surface2); }
.mech-zone-label {
  font-family: 'DM Mono', monospace;
  font-size: 9px;
  letter-spacing: 2px;
  text-transform: uppercase;
  color: var(--text-dim);
  margin-bottom: 16px;
  text-align: center;
}
.mech-icon { font-size: 28px; margin-bottom: 12px; }
.mech-text { font-size: 11px; color: var(--text-mid); text-align: center; line-height: 1.5; }
.mech-arrow {
  position: absolute;
  right: -14px;
  top: 50%;
  transform: translateY(-50%);
  z-index: 2;
  font-size: 20px;
  color: var(--accent);
}

.particle-row {
  display: flex;
  gap: 6px;
  justify-content: center;
  margin: 8px 0;
  flex-wrap: wrap;
}
.particle {
  width: 20px; height: 20px;
  border-radius: 50%;
  display: flex;
  align-items: center;
  justify-content: center;
  font-size: 9px;
  font-weight: 600;
  font-family: 'DM Mono', monospace;
  animation: float 2s ease-in-out infinite;
}
@keyframes float {
  0%,100% { transform: translateY(0); }
  50% { transform: translateY(-4px); }
}
.particle.bicarb { background: rgba(0,212,255,0.2); border: 1px solid var(--accent); color: var(--accent); animation-delay: 0s; }
.particle.hplus { background: rgba(255,71,87,0.2); border: 1px solid var(--danger); color: var(--danger); animation-delay: 0.3s; }
.particle.h2co3 { background: rgba(255,211,42,0.2); border: 1px solid var(--accent4); color: var(--accent4); animation-delay: 0.6s; }
.particle.co2 { background: rgba(168,255,120,0.2); border: 1px solid var(--accent3); color: var(--accent3); animation-delay: 0.9s; }
.particle.pi { background: rgba(192,132,252,0.2); border: 1px solid var(--purple); color: var(--purple); }
.particle.ca { background: rgba(255,107,53,0.2); border: 1px solid var(--accent2); color: var(--accent2); }

/* ‚îÄ‚îÄ WESTERBLAD TOGGLE ‚îÄ‚îÄ */
.toggle-row {
  display: flex;
  align-items: center;
  gap: 12px;
  margin-bottom: 20px;
}
.toggle-btn {
  padding: 8px 20px;
  background: transparent;
  border: 1px solid var(--border2);
  border-radius: 20px;
  color: var(--text-mid);
  font-family: 'DM Mono', monospace;
  font-size: 11px;
  letter-spacing: 1px;
  cursor: pointer;
  transition: all 0.2s;
}
.toggle-btn.active-purple { background: rgba(192,132,252,0.15); border-color: var(--purple); color: var(--purple); }
.toggle-btn:hover { background: var(--surface2); }
.toggle-label { font-size: 13px; color: var(--text-dim); }

.westerblad-panel {
  display: none;
  background: rgba(192,132,252,0.05);
  border: 1px solid rgba(192,132,252,0.2);
  border-radius: 10px;
  padding: 20px;
  margin-top: 16px;
}
.westerblad-panel.show { display: block; }
.westerblad-title {
  font-family: 'DM Mono', monospace;
  font-size: 10px;
  letter-spacing: 3px;
  text-transform: uppercase;
  color: var(--purple);
  margin-bottom: 12px;
}
.westerblad-text { font-size: 13px; color: var(--text-mid); line-height: 1.7; margin-bottom: 12px; }
.westerblad-verdict {
  font-size: 13px;
  color: var(--text);
  background: rgba(192,132,252,0.08);
  border-left: 3px solid var(--purple);
  padding: 12px 16px;
  border-radius: 0 6px 6px 0;
  line-height: 1.6;
}

/* ‚îÄ‚îÄ RACE MODEL ‚îÄ‚îÄ */
.athlete-config {
  display: grid;
  grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
  gap: 20px;
  background: var(--surface2);
  border: 1px solid var(--border);
  border-radius: 12px;
  padding: 24px;
  margin-bottom: 24px;
}

.race-panel {
  background: var(--bg);
  border: 1px solid var(--border);
  border-radius: 10px;
  padding: 20px;
  margin-bottom: 20px;
}
.race-panel-title {
  font-family: 'DM Mono', monospace;
  font-size: 10px;
  letter-spacing: 3px;
  text-transform: uppercase;
  color: var(--text-dim);
  margin-bottom: 16px;
}

/* ‚îÄ‚îÄ ACTIVATE BUTTON ‚îÄ‚îÄ */
.activate-btn {
  display: flex;
  align-items: center;
  gap: 12px;
  padding: 16px 32px;
  background: linear-gradient(135deg, rgba(0,212,255,0.15), rgba(0,212,255,0.05));
  border: 1px solid var(--accent);
  border-radius: 10px;
  color: var(--accent);
  font-family: 'DM Mono', monospace;
  font-size: 13px;
  letter-spacing: 2px;
  text-transform: uppercase;
  cursor: pointer;
  transition: all 0.3s;
  margin-bottom: 24px;
  width: 100%;
  justify-content: center;
}
.activate-btn:hover { background: rgba(0,212,255,0.2); box-shadow: 0 0 24px rgba(0,212,255,0.2); }
.activate-btn.running { border-color: var(--accent2); color: var(--accent2); background: rgba(255,107,53,0.1); }
.activate-btn.done { border-color: var(--accent3); color: var(--accent3); background: rgba(168,255,120,0.08); }
.btn-dot {
  width: 8px; height: 8px;
  border-radius: 50%;
  background: var(--accent);
  animation: pulse 1.5s ease-in-out infinite;
}
@keyframes pulse { 0%,100% { opacity: 1; transform: scale(1); } 50% { opacity: 0.5; transform: scale(0.7); } }
.activate-btn.running .btn-dot { background: var(--accent2); }
.activate-btn.done .btn-dot { background: var(--accent3); animation: none; }

/* ‚îÄ‚îÄ RACE CANVAS ‚îÄ‚îÄ */
.race-canvas-wrap {
  position: relative;
  width: 100%;
  height: 280px;
  background: var(--bg);
  border: 1px solid var(--border);
  border-radius: 10px;
  overflow: hidden;
  margin-bottom: 12px;
}

/* ‚îÄ‚îÄ LAP TABLE ‚îÄ‚îÄ */
.lap-table {
  width: 100%;
  border-collapse: collapse;
  font-family: 'DM Mono', monospace;
  font-size: 12px;
}
.lap-table th {
  text-align: left;
  padding: 10px 14px;
  color: var(--text-dim);
  font-size: 10px;
  letter-spacing: 2px;
  text-transform: uppercase;
  border-bottom: 1px solid var(--border);
}
.lap-table td {
  padding: 10px 14px;
  border-bottom: 1px solid rgba(255,255,255,0.04);
  color: var(--text-mid);
  transition: color 0.3s;
}
.lap-table tr.active td { background: rgba(0,212,255,0.04); }
.lap-table .time-no { color: var(--text-mid); }
.lap-table .time-yes { color: var(--accent3); font-weight: 500; }
.lap-table .diff-pos { color: var(--accent3); }
.lap-table .diff-neg { color: var(--danger); }
.lap-table .diff-zero { color: var(--text-dim); }

/* ‚îÄ‚îÄ STAT STRIP ‚îÄ‚îÄ */
.stat-strip {
  display: flex;
  gap: 12px;
  flex-wrap: wrap;
  margin-top: 20px;
}
.stat-chip {
  flex: 1;
  min-width: 130px;
  background: var(--surface2);
  border: 1px solid var(--border);
  border-radius: 8px;
  padding: 14px 16px;
}
.stat-chip-label {
  font-family: 'DM Mono', monospace;
  font-size: 9px;
  letter-spacing: 2px;
  color: var(--text-dim);
  text-transform: uppercase;
  margin-bottom: 6px;
}
.stat-chip-val {
  font-family: 'DM Serif Display', serif;
  font-size: 20px;
  color: var(--accent);
}
.stat-chip-val.orange { color: var(--accent2); }
.stat-chip-val.green { color: var(--accent3); }
.stat-chip-val.danger { color: var(--danger); }

/* ‚îÄ‚îÄ DIVIDER ‚îÄ‚îÄ */
.divider {
  height: 1px;
  background: var(--border);
  margin: 60px 0;
}

/* ‚îÄ‚îÄ LEGEND ‚îÄ‚îÄ */
.legend {
  display: flex;
  gap: 20px;
  flex-wrap: wrap;
  margin-bottom: 12px;
}
.legend-item {
  display: flex;
  align-items: center;
  gap: 8px;
  font-family: 'DM Mono', monospace;
  font-size: 11px;
  color: var(--text-mid);
}
.legend-line {
  width: 24px;
  height: 3px;
  border-radius: 2px;
}

/* ‚îÄ‚îÄ DEEP DIVE ‚îÄ‚îÄ */
.deep-dive {
  background: rgba(0,212,255,0.04);
  border: 1px solid rgba(0,212,255,0.1);
  border-radius: 10px;
  padding: 16px 20px;
  margin-top: 12px;
}
.deep-dive-toggle {
  background: none;
  border: none;
  color: var(--accent);
  font-family: 'DM Mono', monospace;
  font-size: 11px;
  letter-spacing: 2px;
  cursor: pointer;
  display: flex;
  align-items: center;
  gap: 8px;
}
.deep-dive-content {
  display: none;
  margin-top: 14px;
  font-size: 13px;
  color: var(--text-mid);
  line-height: 1.75;
}
.deep-dive-content.show { display: block; }
.deep-dive-content p { margin-bottom: 10px; }
.deep-dive-content strong { color: var(--text); }
.eqn {
  font-family: 'DM Mono', monospace;
  font-size: 12px;
  background: var(--surface2);
  border: 1px solid var(--border);
  border-radius: 6px;
  padding: 10px 16px;
  margin: 10px 0;
  color: var(--accent4);
}

/* models deep-dive */
.deep-dive {
  background: rgba(0,212,255,0.04);
  border: 1px solid rgba(0,212,255,0.1);
  border-radius: 10px;
  padding: 14px 18px;
  margin-top: 12px;
}
.deep-dive-toggle {
  background: none; border: none;
  color: var(--accent);
  font-family: 'DM Mono', monospace;
  font-size: 11px; letter-spacing: 2px;
  cursor: pointer;
}
.deep-dive-content {
  display: none;
  margin-top: 12px;
  font-size: 13px; color: var(--text-mid); line-height: 1.75;
}
.deep-dive-content.show { display: block; }
.deep-dive-content p { margin-bottom: 10px; }
.deep-dive-content strong { color: var(--text); }
.eqn {
  font-family: 'DM Mono', monospace;
  font-size: 12px;
  background: var(--surface2);
  border: 1px solid var(--border);
  border-radius: 6px;
  padding: 10px 16px;
  margin: 10px 0;
  color: var(--accent4);
}

/* ‚îÄ‚îÄ SUBSTACK CTA ‚îÄ‚îÄ */
.substack-cta {
  margin: 60px auto 24px;
  max-width: 720px;
  background: linear-gradient(135deg, rgba(255,99,20,0.08) 0%, rgba(255,99,20,0.03) 100%);
  border: 1px solid rgba(255,99,20,0.25);
  border-radius: 16px;
  padding: 36px 40px;
  text-align: center;
  position: relative;
  overflow: hidden;
}
.substack-cta::before {
  content: '';
  position: absolute;
  top: -40px; right: -40px;
  width: 200px; height: 200px;
  background: radial-gradient(circle, rgba(255,99,20,0.12) 0%, transparent 70%);
  pointer-events: none;
}
.substack-cta-eyebrow {
  font-family: 'DM Mono', monospace;
  font-size: 10px;
  letter-spacing: 4px;
  text-transform: uppercase;
  color: #ff6314;
  margin-bottom: 12px;
  opacity: 0.8;
}
.substack-cta-title {
  font-family: 'DM Serif Display', serif;
  font-size: 26px;
  line-height: 1.2;
  color: var(--text);
  margin-bottom: 10px;
}
.substack-cta-title em {
  color: #ff6314;
  font-style: italic;
}
.substack-cta-desc {
  font-size: 14px;
  color: var(--text-mid);
  line-height: 1.65;
  max-width: 500px;
  margin: 0 auto 24px;
}
.substack-cta-btn {
  display: inline-flex;
  align-items: center;
  gap: 10px;
  padding: 14px 32px;
  background: linear-gradient(135deg, #ff6314, #ff4500);
  border: none;
  border-radius: 8px;
  color: #fff;
  font-family: 'Instrument Sans', sans-serif;
  font-size: 15px;
  font-weight: 600;
  text-decoration: none;
  cursor: pointer;
  transition: all 0.25s;
  box-shadow: 0 4px 20px rgba(255,99,20,0.35);
}
.substack-cta-btn:hover {
  transform: translateY(-2px);
  box-shadow: 0 8px 32px rgba(255,99,20,0.5);
  background: linear-gradient(135deg, #ff7a35, #ff5500);
}
.substack-cta-btn svg {
  width: 18px; height: 18px; flex-shrink: 0;
}
.substack-cta-note {
  margin-top: 14px;
  font-size: 12px;
  color: var(--text-dim);
}
.substack-cta-note a {
  color: #ff6314;
  text-decoration: none;
  opacity: 0.8;
}
.substack-cta-note a:hover { opacity: 1; text-decoration: underline; }

</style>
</head>
<body>

<!-- SPLASH -->
<div id="splash">
  <div class="splash-formula">NaHCO‚ÇÉ</div>
  <div class="splash-sub">Elite Swimming Intelligence System</div>
  <button class="splash-enter" onclick="enterApp()">Enter ‚Üí</button>
</div>

<!-- APP -->
<div id="app">
  <header>
    <div class="logo">NaHCO‚ÇÉ // INTEL</div>
    <nav>
      <button class="nav-btn active" onclick="showSection('overview', this)">Overview</button>
      <button class="nav-btn" onclick="showSection('evidence', this)">Evidence</button>
      <button class="nav-btn" onclick="showSection('protocol', this)">Protocol</button>
      <button class="nav-btn" onclick="showSection('models', this)">‚öó Models</button>
      <button class="nav-btn" onclick="showSection('debates', this)">Debates</button>
      <button class="nav-btn" onclick="showSection('researchers', this)">Researchers</button>
      <button class="nav-btn" onclick="showSection('gaps', this)">Open Questions</button>
      <button class="nav-btn" onclick="showSection('framework', this)">Coach Framework</button>
      <a href="https://swimed.substack.com/" target="_blank" class="nav-btn substack-btn">‚ú¶ SwimEd</a>
    </nav>
  </header>

  <!-- ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê OVERVIEW ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê -->
  <section id="overview" class="section active">
    <div class="hero">
      <div class="hero-eyebrow">// Sodium Bicarbonate in Elite Swimming</div>
      <h1 class="hero-title">The supplement the<br>evidence actually <em>supports</em></h1>
      <p class="hero-lead">A deep intelligence brief on NaHCO‚ÇÉ ‚Äî its mechanism, evidence base, key debates, unresolved questions, and what a sophisticated coaching program actually does with it. Includes analysis of Bob Bowman's practitioner critique.</p>

      <div class="stat-grid">
        <div class="stat-card" style="--card-accent: var(--accent)">
          <div class="stat-num">1.3%</div>
          <div class="stat-label">Avg. Performance Gain</div>
          <div class="stat-sub">200‚Äì400m events. Small in absolute terms, decisive at elite level.</div>
        </div>
        <div class="stat-card" style="--card-accent: var(--accent3)">
          <div class="stat-num">0.3</div>
          <div class="stat-label">g/kg Optimal Dose</div>
          <div class="stat-sub">The field's consensus number. Below 0.2 unreliable; above adds GI risk, not benefit.</div>
        </div>
        <div class="stat-card" style="--card-accent: var(--warning)">
          <div class="stat-num">60‚Äì180</div>
          <div class="stat-label">min to Peak pH</div>
          <div class="stat-sub">Individual variation is the single most important practical variable.</div>
        </div>
        <div class="stat-card" style="--card-accent: var(--accent2)">
          <div class="stat-num">~30%</div>
          <div class="stat-label">GI Distress Rate</div>
          <div class="stat-sub">Meaningful proportion experience symptoms that can eliminate any gain.</div>
        </div>
        <div class="stat-card" style="--card-accent: var(--danger)">
          <div class="stat-num">~20%</div>
          <div class="stat-label">Studies Include Women</div>
          <div class="stat-sub">A severe evidence gap. Female response may differ significantly.</div>
        </div>
      </div>

      <div class="mechanism-viz">
        <div class="mech-title">// The Core Mechanism</div>
        <div class="mech-flow">
          <div class="mech-step">
            <span class="mech-icon">üíä</span>
            <div class="mech-step-title">Ingestion</div>
            <div class="mech-step-text">0.3 g/kg NaHCO‚ÇÉ taken 60‚Äì180 min pre-race. Blood bicarbonate pool rises.</div>
          </div>
          <div class="mech-arrow">‚Üí</div>
          <div class="mech-step">
            <span class="mech-icon">ü©∏</span>
            <div class="mech-step-title">Alkalosis</div>
            <div class="mech-step-text">Blood pH rises from ~7.4 to 7.5+. Extracellular buffering capacity increases.</div>
          </div>
          <div class="mech-arrow">‚Üí</div>
          <div class="mech-step">
            <span class="mech-icon">üèä</span>
            <div class="mech-step-title">Exercise</div>
            <div class="mech-step-text">Glycolysis produces H‚Å∫. Steeper concentration gradient accelerates efflux from muscle.</div>
          </div>
          <div class="mech-arrow">‚Üí</div>
          <div class="mech-step">
            <span class="mech-icon">‚ö°</span>
            <div class="mech-step-title">Delayed Fatigue</div>
            <div class="mech-step-text">Intracellular pH stays higher longer. Enzyme function preserved. Fatigue postponed.</div>
          </div>
          <div class="mech-arrow">‚Üí</div>
          <div class="mech-step">
            <span class="mech-icon">üèÜ</span>
            <div class="mech-step-title">Performance</div>
            <div class="mech-step-text">~1.3% faster in 200‚Äì400m. In elite racing, often the margin that determines outcomes.</div>
          </div>
        </div>
      </div>
    </div>

    <div class="content-grid">
      <div class="content-card">
        <h3>Why it matters for coaches</h3>
        <p>Unlike most supplements, sodium bicarbonate has a well-characterized mechanism, a decade of consistent evidence at the category level, and IOC endorsement. It sits in a small group of legal ergogenic aids that have cleared the bar of scientific credibility.</p>
        <p>The evidence says it works for 200m and 400m events. The question for a sophisticated program is not whether to consider it ‚Äî it's whether a specific athlete, in a specific context, meets the conditions under which the average effect becomes a reliable individual benefit.</p>
        <div style="margin-top: 16px">
          <span class="tag tag-green">IOC Endorsed</span>
          <span class="tag tag-blue">Legal</span>
          <span class="tag tag-blue">Mechanism Established</span>
          <span class="tag tag-orange">GI Risk</span>
        </div>
      </div>
      <div class="content-card">
        <h3>The leverage framing</h3>
        <p>Think of bicarbonate as borrowing physiological capacity from before the race to spend during it. The pre-race alkalosis is the loan. The race is the expenditure. Like any leverage, it amplifies outcomes in both directions.</p>
        <p>This clarifies when it makes sense: high-stakes competition, well-prepared athlete, validated individual response. It does not make sense for development training, athletes who haven't validated their response, or contexts where GI failure would be catastrophic.</p>
        <div class="insight-block" style="margin-top: 20px; margin-bottom: 0">
          <div class="insight-text">"The question is never whether bicarbonate works ‚Äî it's whether this is the right moment to borrow against physiology."</div>
        </div>
      </div>
    </div>

  <div class="substack-cta">
    <div class="substack-cta-eyebrow">// Chlorinated Chronicles</div>
    <div class="substack-cta-title">More analysis like this,<br>straight to your <em>inbox</em></div>
    <p class="substack-cta-desc">Sports governance, policy analysis, and swimming industry insights ‚Äî written for coaches, scientists, and anyone who thinks seriously about the sport.</p>
    <a href="https://swimed.substack.com/" target="_blank" class="substack-cta-btn">
      <svg viewBox="0 0 24 24" fill="currentColor"><path d="M22.539 8.242H1.46V5.406h21.08v2.836zM1.46 10.812V24L12 18.11 22.54 24V10.812H1.46zM22.54 0H1.46v2.836h21.08V0z"/></svg>
      Subscribe on Substack ‚Äî it's free
    </a>
    <div class="substack-cta-note">Already a reader? <a href="https://swimed.substack.com/" target="_blank">swimed.substack.com</a> ¬∑ No spam, unsubscribe anytime</div>
  </div>
  </section>

  <!-- ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê EVIDENCE ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê -->
  <section id="evidence" class="section">
    <div class="evidence-wrap">
      <div class="section-header">
        <div class="section-eyebrow">// The Evidence Base</div>
        <h2 class="section-title">What the research<br>actually shows</h2>
        <p class="section-desc">A clear-eyed assessment of where the evidence is strong, where it's weak, and where it's been misread.</p>
      </div>

      <div class="tab-bar">
        <button class="tab-btn active" onclick="showTab('ev-strength', this)">Evidence Strength</button>
        <button class="tab-btn" onclick="showTab('ev-distance', this)">Distance Matrix</button>
        <button class="tab-btn" onclick="showTab('ev-critique', this)">Critical Limitations</button>
      </div>

      <div id="ev-strength" class="tab-content active">
        <div style="max-width: 640px; margin-bottom: 40px">
          <p style="color: var(--text-mid); font-size: 14px; line-height: 1.8; margin-bottom: 24px">Evidence quality rated across key claims. The headline 1.3% figure is real but rests on a methodologically mixed literature. Confidence intervals narrow considerably when you restrict to elite athletes and competition conditions.</p>

          <div class="evidence-bar-wrap">
            <div class="evidence-bar-label"><span>Mechanism (H‚Å∫ buffering)</span><span>Very High</span></div>
            <div class="evidence-bar-track"><div class="evidence-bar-fill animate" style="--w: 92%; background: var(--accent3)"></div></div>
          </div>
          <div class="evidence-bar-wrap">
            <div class="evidence-bar-label"><span>Benefit in 200‚Äì400m (trained)</span><span>Moderate‚ÄìHigh</span></div>
            <div class="evidence-bar-track"><div class="evidence-bar-fill animate" style="--w: 72%; background: var(--accent)"></div></div>
          </div>
          <div class="evidence-bar-wrap">
            <div class="evidence-bar-label"><span>Benefit in repeat sprint training</span><span>Moderate</span></div>
            <div class="evidence-bar-track"><div class="evidence-bar-fill animate" style="--w: 58%; background: var(--accent)"></div></div>
          </div>
          <div class="evidence-bar-wrap">
            <div class="evidence-bar-label"><span>Benefit in elite athletes specifically</span><span>Low‚ÄìModerate</span></div>
            <div class="evidence-bar-track"><div class="evidence-bar-fill animate" style="--w: 38%; background: var(--warning)"></div></div>
          </div>
          <div class="evidence-bar-wrap">
            <div class="evidence-bar-label"><span>Benefit in women (female-specific data)</span><span>Low</span></div>
            <div class="evidence-bar-track"><div class="evidence-bar-fill animate" style="--w: 28%; background: var(--warning)"></div></div>
          </div>
          <div class="evidence-bar-wrap">
            <div class="evidence-bar-label"><span>Long-term training adaptation benefit</span><span>Very Low</span></div>
            <div class="evidence-bar-track"><div class="evidence-bar-fill animate" style="--w: 14%; background: var(--danger)"></div></div>
          </div>
          <div class="evidence-bar-wrap">
            <div class="evidence-bar-label"><span>Competition-condition validity</span><span>Near Zero</span></div>
            <div class="evidence-bar-track"><div class="evidence-bar-fill animate" style="--w: 8%; background: var(--danger)"></div></div>
          </div>
        </div>

        <div class="insight-block">
          <div class="insight-text">"The field treats laboratory time-trial findings as direct evidence for competition benefit. This is an inference, not a demonstrated fact. Competition physiology differs from lab physiology in ways that are well-established and uncorrected for."</div>
          <div class="insight-source">// Critical synthesis from evidence review</div>
        </div>
      </div>

      <div id="ev-distance" class="tab-content">
        <p style="color: var(--text-dim); font-size: 13px; margin-bottom: 24px; font-family: 'DM Mono', monospace; letter-spacing: 1px; text-transform: uppercase">Click an event to see evidence summary</p>
        <div class="matrix-grid" id="distanceMatrix">
          <div class="matrix-cell matrix-none" onclick="showDistDetail(this, '50m', 'none')">
            <div class="matrix-label">50m</div>
            <div class="matrix-sub">~22‚Äì28s</div>
          </div>
          <div class="matrix-cell matrix-low" onclick="showDistDetail(this, '100m', 'low')">
            <div class="matrix-label">100m</div>
            <div class="matrix-sub">~46‚Äì58s</div>
          </div>
          <div class="matrix-cell matrix-high" onclick="showDistDetail(this, '200m', 'high')">
            <div class="matrix-label">200m</div>
            <div class="matrix-sub">~1:45‚Äì2:00</div>
          </div>
          <div class="matrix-cell matrix-high" onclick="showDistDetail(this, '400m', 'high')">
            <div class="matrix-label">400m</div>
            <div class="matrix-sub">~3:40‚Äì4:30</div>
          </div>
          <div class="matrix-cell matrix-low" onclick="showDistDetail(this, '800m+', 'low')">
            <div class="matrix-label">800m+</div>
            <div class="matrix-sub">&gt;8 min</div>
          </div>
        </div>
        <div class="matrix-detail" id="distDetail">
          Select an event above to see the evidence summary for that distance.
        </div>

        <div style="margin-top: 32px">
          <div style="display: flex; gap: 16px; flex-wrap: wrap">
            <div style="display: flex; align-items: center; gap: 8px; font-size: 12px; color: var(--text-dim)">
              <div style="width: 12px; height: 12px; border-radius: 2px; background: rgba(168,255,120,0.3)"></div>
              Strong evidence of benefit
            </div>
            <div style="display: flex; align-items: center; gap: 8px; font-size: 12px; color: var(--text-dim)">
              <div style="width: 12px; height: 12px; border-radius: 2px; background: rgba(255,211,42,0.3)"></div>
              Mixed / borderline evidence
            </div>
            <div style="display: flex; align-items: center; gap: 8px; font-size: 12px; color: var(--text-dim)">
              <div style="width: 12px; height: 12px; border-radius: 2px; background: rgba(255,71,87,0.3)"></div>
              No reliable evidence of benefit
            </div>
          </div>
        </div>
      </div>

      <div id="ev-critique" class="tab-content">
        <div class="content-grid" style="padding: 0">
          <div class="content-card">
            <h3>The blinding problem</h3>
            <p>Most bicarbonate studies are nominally "double-blind" but functionally single-blind. Athletes frequently know they've received the active treatment due to GI sensations, taste, and physiological awareness. Expectancy alone can drive performance improvements of 1‚Äì2% ‚Äî precisely the magnitude bicarbonate produces.</p>
            <p>One recent study using an "ergolytic" framing showed expectancy substantially altered outcomes even when the substance was identical across conditions. The true pharmacological contribution may be materially smaller than reported literature suggests.</p>
          </div>
          <div class="content-card">
            <h3>The small-sample problem</h3>
            <p>The characteristic bicarbonate study uses 6‚Äì10 participants. Meta-analyses pool these studies but don't solve the small-sample problem ‚Äî they aggregate it. The 1.3% figure has the appearance of precision that its underlying data doesn't warrant.</p>
            <p>Publication bias compounds this: null results are systematically less likely to be published. Funnel plot asymmetry in the meta-analyses suggests the true average effect size is smaller than what appears in the literature.</p>
          </div>
          <div class="content-card">
            <h3>The population gap</h3>
            <p>The entire evidence base is built on moderately trained athletes. Elite swimmers have spent years specifically developing the buffering systems bicarbonate is supposed to augment. Whether exogenous bicarbonate produces meaningful marginal gains on top of highly trained acid-base regulation is genuinely unknown.</p>
            <p>Studies that do include elite athletes produce inconsistent results. The extrapolation from college-level time trials to Olympic-level competition is an inference the field makes with more confidence than the data supports.</p>
          </div>
          <div class="content-card">
            <h3>The mechanism assumption</h3>
            <p>The consensus story ‚Äî H‚Å∫ buffering delays acidosis-driven fatigue ‚Äî is elegant but increasingly contested. Westerblad's muscle physiology work has demonstrated that inorganic phosphate accumulation and calcium handling disruption may be more important than H‚Å∫ in contractile failure.</p>
            <p>If the mechanism is wrong or incomplete, optimizing use based on the acid-base rationale is working from an incorrect map. Bicarbonate may work through partially different pathways than the field assumes ‚Äî including central/perceptual effects that are almost entirely uninvestigated.</p>
          </div>
        </div>
      </div>
    </div>

  <div class="substack-cta">
    <div class="substack-cta-eyebrow">// Chlorinated Chronicles</div>
    <div class="substack-cta-title">More analysis like this,<br>straight to your <em>inbox</em></div>
    <p class="substack-cta-desc">Sports governance, policy analysis, and swimming industry insights ‚Äî written for coaches, scientists, and anyone who thinks seriously about the sport.</p>
    <a href="https://swimed.substack.com/" target="_blank" class="substack-cta-btn">
      <svg viewBox="0 0 24 24" fill="currentColor"><path d="M22.539 8.242H1.46V5.406h21.08v2.836zM1.46 10.812V24L12 18.11 22.54 24V10.812H1.46zM22.54 0H1.46v2.836h21.08V0z"/></svg>
      Subscribe on Substack ‚Äî it's free
    </a>
    <div class="substack-cta-note">Already a reader? <a href="https://swimed.substack.com/" target="_blank">swimed.substack.com</a> ¬∑ No spam, unsubscribe anytime</div>
  </div>
  </section>

  <!-- ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê PROTOCOL ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê -->
  <section id="protocol" class="section">
    <div class="protocol-wrap">
      <div class="section-header">
        <div class="section-eyebrow">// Practical Protocol</div>
        <h2 class="section-title">Implementation<br>for elite programs</h2>
        <p class="section-desc">Evidence-based guidance on dosing, timing, delivery, and the individualization process that separates sophisticated use from naive application.</p>
      </div>

      <!-- DOSING CALCULATOR -->
      <div class="calc-card">
        <div class="calc-title">// Dose Calculator</div>
        <div class="calc-row">
          <div class="calc-field">
            <label>Athlete Body Weight (kg)</label>
            <input type="number" id="bodyWeight" placeholder="e.g. 75" oninput="calcDose()" min="40" max="120">
          </div>
          <div class="calc-field">
            <label>GI Tolerance (from training trials)</label>
            <select id="giTolerance" onchange="calcDose()">
              <option value="">‚Äî Select ‚Äî</option>
              <option value="good">Good (no prior issues)</option>
              <option value="moderate">Moderate (mild symptoms)</option>
              <option value="poor">Poor (significant symptoms)</option>
              <option value="unknown">Unknown (untested)</option>
            </select>
          </div>
        </div>
        <div class="calc-row">
          <div class="calc-field">
            <label>Event Distance</label>
            <select id="eventDist" onchange="calcDose()">
              <option value="">‚Äî Select ‚Äî</option>
              <option value="50">50m</option>
              <option value="100">100m</option>
              <option value="200">200m</option>
              <option value="400">400m</option>
              <option value="800">800m+</option>
            </select>
          </div>
          <div class="calc-field">
            <label>Individual Peak Time (if known)</label>
            <select id="peakTime" onchange="calcDose()">
              <option value="">‚Äî Unknown / Not Yet Tested ‚Äî</option>
              <option value="60">~60 minutes (fast absorber)</option>
              <option value="90">~90 minutes (average)</option>
              <option value="120">~120 minutes</option>
              <option value="150">~150+ minutes (slow absorber)</option>
            </select>
          </div>
        </div>
        <div id="calcOutput" style="display:none">
          <div class="calc-result">
            <div class="result-item">
              <span class="result-num" id="doseGrams">‚Äî</span>
              <div class="result-label">Grams NaHCO‚ÇÉ</div>
            </div>
            <div class="result-item">
              <span class="result-num" id="ingestTime">‚Äî</span>
              <div class="result-label">Min Pre-Race</div>
            </div>
            <div class="result-item">
              <span class="result-num" id="expectedGain">‚Äî</span>
              <div class="result-label">Expected Gain</div>
            </div>
          </div>
          <div id="riskNote" class="risk-bar" style="margin-top: 16px"></div>
        </div>
        <p style="font-size: 11px; color: var(--text-dim); margin-top: 16px; font-family: 'DM Mono', monospace">* Calculator provides guidance estimates. Always validate with individual training trials before competition use.</p>
      </div>

      <!-- GI RISK METER -->
      <div class="content-card" style="margin-bottom: 32px">
        <h3 style="margin-bottom: 20px">GI Risk by Delivery Format</h3>
        <p style="font-size: 13px; color: var(--text-dim); margin-bottom: 24px; line-height: 1.7">The delivery format significantly affects GI tolerance without necessarily changing efficacy. Hover/click each option to see risk level.</p>
        <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(180px, 1fr)); gap: 12px">
          <div class="matrix-cell" style="cursor:pointer; background: rgba(255,71,87,0.1); border-color: rgba(255,71,87,0.3)" onclick="setMeter(85, 'NaHCO‚ÇÉ in water solution ‚Äî fastest absorption, highest GI risk. Most studies use this format.')">
            <div class="matrix-label" style="color: var(--danger)">Solution</div>
            <div class="matrix-sub" style="color: var(--danger)">Highest risk</div>
          </div>
          <div class="matrix-cell" style="cursor:pointer; background: rgba(255,211,42,0.08); border-color: rgba(255,211,42,0.3)" onclick="setMeter(55, 'Taken with a carbohydrate-rich meal slows absorption, reduces GI distress, slightly delays peak. Good compromise.')">
            <div class="matrix-label" style="color: var(--warning)">With Food</div>
            <div class="matrix-sub" style="color: var(--warning)">Moderate risk</div>
          </div>
          <div class="matrix-cell" style="cursor:pointer; background: rgba(0,212,255,0.08); border-color: rgba(0,212,255,0.3)" onclick="setMeter(40, 'Split dose over 30‚Äì60 minutes reduces peak GI load. Effective for athletes with moderate tolerance issues.')">
            <div class="matrix-label" style="color: var(--accent)">Split Dose</div>
            <div class="matrix-sub" style="color: var(--accent)">Lower risk</div>
          </div>
          <div class="matrix-cell" style="cursor:pointer; background: rgba(168,255,120,0.08); border-color: rgba(168,255,120,0.3)" onclick="setMeter(22, 'Enteric-coated capsules bypass stomach, slower and more variable absorption. Lowest GI risk but peak timing harder to control.')">
            <div class="matrix-label" style="color: var(--accent3)">Capsules</div>
            <div class="matrix-sub" style="color: var(--accent3)">Lowest risk</div>
          </div>
        </div>
        <div class="meter-track" style="margin-top: 20px">
          <div class="meter-needle" id="meterNeedle" style="left: 50%"></div>
        </div>
        <div class="meter-labels">
          <span>Low GI Risk</span>
          <span>High GI Risk</span>
        </div>
        <div id="meterNote" style="margin-top: 12px; font-size: 12px; color: var(--text-dim); line-height: 1.6; min-height: 36px; transition: all 0.3s">
          Click a delivery format above to see the risk profile.
        </div>
      </div>

      <!-- TIMING TIMELINE -->
      <div class="section-header" style="margin-top: 48px">
        <div class="section-eyebrow">// Race Day Timeline</div>
        <h3 style="font-family: 'DM Serif Display', serif; font-size: 28px">The 3-hour window</h3>
      </div>
      <div class="protocol-timeline">
        <div class="timeline-item">
          <div class="timeline-dot"></div>
          <div class="timeline-time">T ‚Äì 3h to T ‚Äì 2h</div>
          <div class="timeline-title">Standardized Pre-Load Meal</div>
          <div class="timeline-desc">Low-fiber, familiar carbohydrate meal. No new foods. This is not the time for experimentation. Hydration established.</div>
        </div>
        <div class="timeline-item">
          <div class="timeline-dot"></div>
          <div class="timeline-time">T ‚Äì [Individual Peak Time]</div>
          <div class="timeline-title">NaHCO‚ÇÉ Ingestion</div>
          <div class="timeline-desc">0.3 g/kg with 500‚Äì750mL water. Timing determined by individual peak-time protocol established in training trials ‚Äî not a generic recommendation. Range: 60‚Äì180 min.</div>
        </div>
        <div class="timeline-item">
          <div class="timeline-dot"></div>
          <div class="timeline-time">T ‚Äì 45 to T ‚Äì 30min</div>
          <div class="timeline-title">Monitor & Confirm</div>
          <div class="timeline-desc">Athlete should confirm absence of significant GI distress. If moderate symptoms: proceed with awareness. If severe symptoms: contingency ‚Äî the race strategy shifts to unassisted performance.</div>
        </div>
        <div class="timeline-item">
          <div class="timeline-dot"></div>
          <div class="timeline-time">T ‚Äì 20min</div>
          <div class="timeline-title">Warm-Up</div>
          <div class="timeline-desc">Standard race warm-up. If everything is on schedule and GI status is clear, blood bicarbonate should be approaching or at peak. This is the intended physiological state entering competition.</div>
        </div>
        <div class="timeline-item">
          <div class="timeline-dot"></div>
          <div class="timeline-time">T ‚Äì 0</div>
          <div class="timeline-title">Race</div>
          <div class="timeline-desc">Peak alkalotic state deployed. H‚Å∫ efflux enhanced. The biological loan is now being spent. Performance delta: aim for 1‚Äì2% improvement in 200‚Äì400m events relative to baseline.</div>
        </div>
      </div>

      <!-- INDIVIDUALIZATION PROTOCOL -->
      <div class="content-card" style="margin-top: 16px">
        <h3>The Individualization Protocol ‚Äî Non-Negotiable</h3>
        <p>The single most important insight from the research that most programs skip: individual time-to-peak blood bicarbonate varies from 60 to 180+ minutes. An athlete who peaks at 90 minutes and takes it 60 minutes before a race is competing in a declining alkalotic state, not a peak one.</p>
        <p><strong style="color: var(--text)">Minimum protocol before any competition use:</strong> 3‚Äì5 training sessions at competition intensity using 0.3 g/kg, with varied ingestion timing (60, 90, 120 min), tracking both GI response and perceived exertion during the set. Establish individual peak window. Establish GI tolerance threshold. Only then commit to a competition timing.</p>
        <p>This isn't optional refinement. It's the difference between using bicarbonate intelligently and using it naively.</p>
      </div>
    </div>

  <div class="substack-cta">
    <div class="substack-cta-eyebrow">// Chlorinated Chronicles</div>
    <div class="substack-cta-title">More analysis like this,<br>straight to your <em>inbox</em></div>
    <p class="substack-cta-desc">Sports governance, policy analysis, and swimming industry insights ‚Äî written for coaches, scientists, and anyone who thinks seriously about the sport.</p>
    <a href="https://swimed.substack.com/" target="_blank" class="substack-cta-btn">
      <svg viewBox="0 0 24 24" fill="currentColor"><path d="M22.539 8.242H1.46V5.406h21.08v2.836zM1.46 10.812V24L12 18.11 22.54 24V10.812H1.46zM22.54 0H1.46v2.836h21.08V0z"/></svg>
      Subscribe on Substack ‚Äî it's free
    </a>
    <div class="substack-cta-note">Already a reader? <a href="https://swimed.substack.com/" target="_blank">swimed.substack.com</a> ¬∑ No spam, unsubscribe anytime</div>
  </div>
  </section>

  <!-- ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê DEBATES ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê -->
  <section id="debates" class="section">
    <div class="evidence-wrap">
      <div class="section-header">
        <div class="section-eyebrow">// Active Debates</div>
        <h2 class="section-title">The real<br>disagreements</h2>
        <p class="section-desc">Where serious researchers and coaches actually disagree ‚Äî not the caricatured version, but the strongest arguments on each side.</p>
      </div>

      <div style="margin-bottom: 16px">
        <div class="tab-bar">
          <button class="tab-btn active" onclick="showTab('d1',this)">Elite Efficacy</button>
          <button class="tab-btn" onclick="showTab('d2',this)">GI Problem</button>
          <button class="tab-btn" onclick="showTab('d3',this)">Training Use</button>
          <button class="tab-btn" onclick="showTab('d4',this)">Beta-Alanine Stack</button>
          <button class="tab-btn" onclick="showTab('d5',this)">Youth Athletes</button>
          <button class="tab-btn" onclick="showTab('d6',this)">Bowman's Lens</button>
        </div>
      </div>

      <div id="d1" class="tab-content active">
        <div class="debate-container">
          <div class="debate-side pro">
            <div class="debate-label">For elite use</div>
            <div class="debate-item"><div class="debate-dot"></div><div class="debate-text"><strong>Marginal gains matter more at elite level.</strong> A 1.3% improvement in a 200m race can determine whether an athlete makes a final or misses it. The asymmetry of stakes justifies use even at lower reliability.</div></div>
            <div class="debate-item"><div class="debate-dot"></div><div class="debate-text"><strong>IOC and ISSN endorsement</strong> reflects serious review by experts who have assessed the evidence specifically for high-performance athletes. The institutional weight of that consensus should carry something.</div></div>
            <div class="debate-item"><div class="debate-dot"></div><div class="debate-text"><strong>The cost of not using it</strong> ‚Äî if competitors are using bicarbonate effectively, not using it is itself a competitive decision with a cost. The asymmetry cuts both ways.</div></div>
          </div>
          <div class="debate-side con">
            <div class="debate-label">Against / Skeptical</div>
            <div class="debate-item"><div class="debate-dot"></div><div class="debate-text"><strong>Elite athletes are absent from the evidence base.</strong> Studies use moderately trained college swimmers. Elite swimmers have spent years developing the very systems bicarbonate is supposed to augment. The marginal gain is likely smaller.</div></div>
            <div class="debate-item"><div class="debate-dot"></div><div class="debate-text"><strong>When studies do include elite athletes, results become inconsistent.</strong> The extrapolation from college-level time trials to Olympic finals is an inference, not a demonstrated finding.</div></div>
            <div class="debate-item"><div class="debate-dot"></div><div class="debate-text"><strong>GI failure risk is higher in real competition</strong> than in laboratory conditions. The probability of catastrophic GI distress in an Olympic final ‚Äî with elevated cortisol, different pre-race nutrition ‚Äî is not captured by controlled studies.</div></div>
          </div>
        </div>
        <div class="insight-block">
          <div class="insight-text">"The honest verdict: use it at elite level, but hold your confidence in the magnitude of benefit loosely. The evidence supports trying it ‚Äî not guaranteeing it."</div>
        </div>
      </div>

      <div id="d2" class="tab-content">
        <div class="debate-container">
          <div class="debate-side pro">
            <div class="debate-label">GI is manageable</div>
            <div class="debate-item"><div class="debate-dot"></div><div class="debate-text"><strong>Protocol optimization significantly reduces distress.</strong> Splitting doses, taking with food, using capsules, and individualized timing all demonstrably reduce GI symptoms. The problem is real but solvable with expertise.</div></div>
            <div class="debate-item"><div class="debate-dot"></div><div class="debate-text"><strong>Most athletes who tolerate it well</strong> had access to proper individualization protocols. The high dropout rate reflects naive application, not an inherent property of the supplement.</div></div>
          </div>
          <div class="debate-side con">
            <div class="debate-label">GI is a fundamental barrier</div>
            <div class="debate-item"><div class="debate-dot"></div><div class="debate-text"><strong>Protocols reduce GI risk but don't eliminate it.</strong> Even with optimized delivery, a meaningful proportion of athletes experience symptoms. In competition, even reduced risk of GI failure is a serious cost.</div></div>
            <div class="debate-item"><div class="debate-dot"></div><div class="debate-text"><strong>Researchers underweight GI severity</strong> because they study lab settings. Acute diarrhea during a race isn't "losing 1.3%." It's potentially losing everything in a non-repeatable high-stakes event.</div></div>
            <div class="debate-item"><div class="debate-dot"></div><div class="debate-text"><strong>Trialling in training doesn't build tolerance.</strong> Siegler's research showed GI symptoms remained inconsistent across repeated trials ‚Äî exposure doesn't necessarily habituate the gut to the stress.</div></div>
          </div>
        </div>
      </div>

      <div id="d3" class="tab-content">
        <div class="debate-container">
          <div class="debate-side pro">
            <div class="debate-label">Use in training</div>
            <div class="debate-item"><div class="debate-dot"></div><div class="debate-text"><strong>Higher training loads possible.</strong> If bicarbonate allows athletes to sustain greater intensity or volume in key training sessions, the total adaptive stimulus may be larger, producing superior long-term gains.</div></div>
            <div class="debate-item"><div class="debate-dot"></div><div class="debate-text"><strong>Some research suggests enhanced PGC-1Œ± expression</strong> post-exercise with bicarbonate, pointing toward enhanced mitochondrial adaptation ‚Äî the opposite of blunting adaptation.</div></div>
          </div>
          <div class="debate-side con">
            <div class="debate-label">Training use may backfire</div>
            <div class="debate-item"><div class="debate-dot"></div><div class="debate-text"><strong>Metabolic acidosis is part of the adaptive signal.</strong> The stress of H‚Å∫ accumulation drives upregulation of buffering enzymes, MCTs, and intracellular buffering proteins. Blunting this signal may reduce the training stimulus even as it increases volume.</div></div>
            <div class="debate-item"><div class="debate-dot"></div><div class="debate-text"><strong>Siegler's 10-week study found no additional training adaptation</strong> from bicarbonate-assisted resistance training. One study, one modality ‚Äî but the only direct evidence on the question, and it doesn't support chronic training use.</div></div>
            <div class="debate-item"><div class="debate-dot"></div><div class="debate-text"><strong>Long-term data is essentially absent.</strong> Programs are adopting chronic training use before anyone has established whether it helps or harms development across a competitive season.</div></div>
          </div>
        </div>
      </div>

      <div id="d4" class="tab-content">
        <div class="debate-container">
          <div class="debate-side pro">
            <div class="debate-label">Stack has additive value</div>
            <div class="debate-item"><div class="debate-dot"></div><div class="debate-text"><strong>Complementary mechanisms.</strong> Beta-alanine buffers intracellularly (carnosine in muscle), bicarbonate buffers extracellularly (blood). These are non-overlapping mechanisms that should theoretically add.</div></div>
            <div class="debate-item"><div class="debate-dot"></div><div class="debate-text"><strong>Some studies show increased probability of benefit</strong> from the combination (65% ‚Üí 71% in one analysis). For events like the 100m where bicarbonate alone is borderline, the stack may tip the balance.</div></div>
          </div>
          <div class="debate-side con">
            <div class="debate-label">Stack evidence is weak</div>
            <div class="debate-item"><div class="debate-dot"></div><div class="debate-text"><strong>Statistical significance is rarely achieved</strong> in combination studies. Moving from "65% probability of benefit" to "71%" is not a compelling finding to justify two supplements with two side-effect profiles.</div></div>
            <div class="debate-item"><div class="debate-dot"></div><div class="debate-text"><strong>Beta-alanine causes paresthesia; bicarbonate causes GI distress.</strong> The combined side-effect burden on an athlete preparing for an important race is non-trivial. The bar for recommending the combination should be higher than "trends toward improvement."</div></div>
          </div>
        </div>
      </div>

      <div id="d5" class="tab-content">
        <div class="debate-container">
          <div class="debate-side pro">
            <div class="debate-label">Appropriate for youth</div>
            <div class="debate-item"><div class="debate-dot"></div><div class="debate-text"><strong>Same physiology, same mechanism.</strong> Studies on competitive youth swimmers (~15 years) show the buffering mechanism operates identically, with measurable blood pH responses and performance improvements comparable to adults.</div></div>
            <div class="debate-item"><div class="debate-dot"></div><div class="debate-text"><strong>Competitive parity.</strong> If senior youth athletes are competing at near-elite level and peers at other programs may be using bicarbonate, withholding it may be a competitive disadvantage.</div></div>
          </div>
          <div class="debate-side con">
            <div class="debate-label">Premature for youth</div>
            <div class="debate-item"><div class="debate-dot"></div><div class="debate-text"><strong>Zero long-term adolescent data.</strong> Chronic use during development is completely unstudied. Adolescent physiology is still developing, and the effects of repeated acute alkalosis on natural buffering development are unknown.</div></div>
            <div class="debate-item"><div class="debate-dot"></div><div class="debate-text"><strong>Supplement culture risk.</strong> Normalizing supplementation early ‚Äî even with a legal substance ‚Äî shapes athletes' relationship with performance enhancement in ways that may carry over to riskier choices later. Most sports medicine practitioners recommend postponing until training-based adaptation is exhausted.</div></div>
            <div class="debate-item"><div class="debate-dot"></div><div class="debate-text"><strong>Youth athletes haven't reached their natural ceiling.</strong> The rationale for supplementation is weakest precisely where natural adaptation potential is greatest.</div></div>
          </div>
        </div>
      </div>

      <div id="d6" class="tab-content">
        <div class="insight-block" style="margin-bottom: 28px">
          <div class="insight-text">"The research says it works and it does. But you know how it works? It works with a specific dose for a specific physiology at an incredibly specific time before a specific event. So if you want to stand back here and take a dart and throw it at a bullseye that's two rooms over there and hope you hit it, take your sodium bicarb."</div>
          <div class="insight-source">// Bob Bowman ‚Äî Coach of Michael Phelps, L√©on Marchand, Summer McIntosh</div>
        </div>
        <div class="debate-container">
          <div class="debate-side pro">
            <div class="debate-label">Where Bowman is right</div>
            <div class="debate-item"><div class="debate-dot"></div><div class="debate-text"><strong>The precision requirement is real.</strong> Individual time-to-peak blood bicarbonate varies 60‚Äì180 minutes. That's not a minor footnote ‚Äî it's the entire practical problem. Without individualized timing trials, dart-throw is an accurate metaphor.</div></div>
            <div class="debate-item"><div class="debate-dot"></div><div class="debate-text"><strong>First-time race-day use is indefensible.</strong> The US Open story ‚Äî athlete runs to the bathroom before the 200 free final after first-ever use ‚Äî is not anecdote, it's the documented ~30% GI distress phenomenon. Bowman's position here is exactly correct.</div></div>
            <div class="debate-item"><div class="debate-dot"></div><div class="debate-text"><strong>Priority ordering matters.</strong> Hydration, carbohydrate fueling, and training consistency have far larger effect sizes across a far wider population. Optimizing the edges before the center is a coaching error Bowman has been diagnosing across all of his session advice ‚Äî not just with supplements.</div></div>
            <div class="debate-item"><div class="debate-dot"></div><div class="debate-text"><strong>Practitioner experience from the 1990s.</strong> Bowman and Bergen were using it with elite swimmers decades ago. His skepticism is hard-won applied experience, not scientific naivety.</div></div>
          </div>
          <div class="debate-side con">
            <div class="debate-label">Where Bowman oversimplifies</div>
            <div class="debate-item"><div class="debate-dot"></div><div class="debate-text"><strong>He conflates naive use with all use.</strong> The dart-throw version he describes is not what sophisticated application looks like. Three to five individualized timing trials in training is feasible. His critique applies to unvalidated deployment; it does not apply to properly individualized protocols.</div></div>
            <div class="debate-item"><div class="debate-dot"></div><div class="debate-text"><strong>"Waste of time" is rhetoric, not his actual position.</strong> His own words immediately undercut the dismissal: "it does work if you had a doctor test your blood, test your body weight, know exactly when you're going to swim..." That is a description of the conditions for effective use ‚Äî not a claim it doesn't work.</div></div>
            <div class="debate-item"><div class="debate-dot"></div><div class="debate-text"><strong>Elite programs have the infrastructure he describes.</strong> Blood testing, body composition, sports science staff, controlled pre-race timelines ‚Äî these are standard at D1 university and national programs. His argument is most valid for club swimmers; it weakens considerably for the highest-resourced environments.</div></div>
            <div class="debate-item"><div class="debate-dot"></div><div class="debate-text"><strong>"13 minutes and 30 seconds" is hyperbole.</strong> Peak alkalosis windows are roughly 20‚Äì40 minutes wide. The precision required is meaningful but not absurdly narrow. Athletes are threading a window, not a needle.</div></div>
          </div>
        </div>
        <div class="insight-block" style="margin-top: 20px">
          <div class="insight-text">Bowman's real argument is about coaching epistemology ‚Äî what deserves attention. His bicarbonate comments fit the same pattern as everything else he coaches: don't do power training with age groupers, don't vary strokes before repetition builds stability, don't reach for the hack before the fundamentals are solid. Sodium bicarbonate is one more case of "optimizing around the edges before the center is solid." This is a practitioner insight, not a scientific refutation.</div>
          <div class="insight-source">// Synthesis ‚Äî Practitioner vs. Research Framing</div>
        </div>
      </div>

    </div>

  <div class="substack-cta">
    <div class="substack-cta-eyebrow">// Chlorinated Chronicles</div>
    <div class="substack-cta-title">More analysis like this,<br>straight to your <em>inbox</em></div>
    <p class="substack-cta-desc">Sports governance, policy analysis, and swimming industry insights ‚Äî written for coaches, scientists, and anyone who thinks seriously about the sport.</p>
    <a href="https://swimed.substack.com/" target="_blank" class="substack-cta-btn">
      <svg viewBox="0 0 24 24" fill="currentColor"><path d="M22.539 8.242H1.46V5.406h21.08v2.836zM1.46 10.812V24L12 18.11 22.54 24V10.812H1.46zM22.54 0H1.46v2.836h21.08V0z"/></svg>
      Subscribe on Substack ‚Äî it's free
    </a>
    <div class="substack-cta-note">Already a reader? <a href="https://swimed.substack.com/" target="_blank">swimed.substack.com</a> ¬∑ No spam, unsubscribe anytime</div>
  </div>
  </section>

  <!-- ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê RESEARCHERS ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê -->
  <section id="researchers" class="section">
    <div class="evidence-wrap">
      <div class="section-header">
        <div class="section-eyebrow">// Key Figures</div>
        <h2 class="section-title">Who shapes<br>this field</h2>
        <p class="section-desc">The researchers and organizations whose work you'll encounter most in this literature ‚Äî and what each actually argues.</p>
      </div>

      <div class="researcher-grid" id="researcherGrid">
      </div>
    </div>

  <div class="substack-cta">
    <div class="substack-cta-eyebrow">// Chlorinated Chronicles</div>
    <div class="substack-cta-title">More analysis like this,<br>straight to your <em>inbox</em></div>
    <p class="substack-cta-desc">Sports governance, policy analysis, and swimming industry insights ‚Äî written for coaches, scientists, and anyone who thinks seriously about the sport.</p>
    <a href="https://swimed.substack.com/" target="_blank" class="substack-cta-btn">
      <svg viewBox="0 0 24 24" fill="currentColor"><path d="M22.539 8.242H1.46V5.406h21.08v2.836zM1.46 10.812V24L12 18.11 22.54 24V10.812H1.46zM22.54 0H1.46v2.836h21.08V0z"/></svg>
      Subscribe on Substack ‚Äî it's free
    </a>
    <div class="substack-cta-note">Already a reader? <a href="https://swimed.substack.com/" target="_blank">swimed.substack.com</a> ¬∑ No spam, unsubscribe anytime</div>
  </div>
  </section>

  <!-- ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê GAPS ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê -->
  <section id="gaps" class="section">
    <div class="evidence-wrap">
      <div class="section-header">
        <div class="section-eyebrow">// Open Questions</div>
        <h2 class="section-title">What we don't<br>actually know</h2>
        <p class="section-desc">The underexplored angles, systematic blind spots, and genuinely unresolved questions that sophisticated practitioners should hold.</p>
      </div>

      <div class="gaps-grid" id="gapsGrid"></div>

      <div class="divider"></div>

      <div class="section-header">
        <div class="section-eyebrow">// The Meta-Question</div>
        <h3 style="font-family: 'DM Serif Display', serif; font-size: 32px; margin-bottom: 16px">The competition validity problem</h3>
      </div>
      <div class="insight-block">
        <div class="insight-text">"The entire evidence base comes from laboratory time trials and training simulations. The number of studies conducted in actual competition ‚Äî with real race-day stress, competitive opponents, audience effects, and the full psychological weight of meaningful performance ‚Äî is essentially zero."</div>
        <div class="insight-source">// Identified gap from evidence synthesis</div>
      </div>
      <p style="font-size: 14px; color: var(--text-mid); line-height: 1.8; max-width: 700px; margin-top: 20px">Stress hormones differ in competition versus training. Motivational state affects pacing. The presence of competitors changes effort selection. Cortisol and adrenaline alter GI motility ‚Äî precisely the mechanism by which bicarbonate causes problems. None of this is captured in existing research. The translation from laboratory to competition is an assumption, not a demonstrated fact. This is the deepest unresolved issue in the entire literature.</p>
    </div>

  <div class="substack-cta">
    <div class="substack-cta-eyebrow">// Chlorinated Chronicles</div>
    <div class="substack-cta-title">More analysis like this,<br>straight to your <em>inbox</em></div>
    <p class="substack-cta-desc">Sports governance, policy analysis, and swimming industry insights ‚Äî written for coaches, scientists, and anyone who thinks seriously about the sport.</p>
    <a href="https://swimed.substack.com/" target="_blank" class="substack-cta-btn">
      <svg viewBox="0 0 24 24" fill="currentColor"><path d="M22.539 8.242H1.46V5.406h21.08v2.836zM1.46 10.812V24L12 18.11 22.54 24V10.812H1.46zM22.54 0H1.46v2.836h21.08V0z"/></svg>
      Subscribe on Substack ‚Äî it's free
    </a>
    <div class="substack-cta-note">Already a reader? <a href="https://swimed.substack.com/" target="_blank">swimed.substack.com</a> ¬∑ No spam, unsubscribe anytime</div>
  </div>
  </section>

  <!-- ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê FRAMEWORK ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê -->
  <section id="framework" class="section">
    <div class="framework-wrap">
      <div class="section-header">
        <div class="section-eyebrow">// Coaching Framework</div>
        <h2 class="section-title">The 20% that<br>explains everything</h2>
        <p class="section-desc">What a sophisticated coaching program actually does ‚Äî distilled from the full evidence base into actionable principles.</p>
      </div>

      <!-- DECISION TOOL -->
      <div class="decision-tree">
        <div class="mech-title">// Should This Athlete Use Bicarbonate? Decision Tool</div>
        <div id="treeQ1">
          <div class="tree-question">What event is the athlete preparing for?</div>
          <div class="tree-options">
            <div class="tree-option" onclick="treeSelect(this, 'event', '50-100')">50m or 100m</div>
            <div class="tree-option" onclick="treeSelect(this, 'event', '200-400')">200m or 400m</div>
            <div class="tree-option" onclick="treeSelect(this, 'event', '800+')">800m or above</div>
            <div class="tree-option" onclick="treeSelect(this, 'event', 'training')">Training session only</div>
          </div>
        </div>
        <div id="treeQ2" style="display:none; margin-top: 20px">
          <div class="tree-question">Has this athlete completed individualized timing trials in training?</div>
          <div class="tree-options">
            <div class="tree-option" onclick="treeSelect(this, 'trials', 'yes')">Yes ‚Äî 3+ sessions, timing established</div>
            <div class="tree-option" onclick="treeSelect(this, 'trials', 'no')">No ‚Äî not yet tested</div>
          </div>
        </div>
        <div id="treeQ3" style="display:none; margin-top: 20px">
          <div class="tree-question">What was the athlete's GI response during training trials?</div>
          <div class="tree-options">
            <div class="tree-option" onclick="showFinalResult('proceed', 'Clear to proceed. Evidence supports use for this event. Implement individualized timing from training trials. Monitor GI status on race day and have a contingency plan. Expected benefit: ~1‚Äì1.3% in 200m, ~0.6% in 400m.')">Minimal to none</div>
            <div class="tree-option" onclick="showFinalResult('caution', 'Proceed with caution. Mild GI symptoms suggest modified delivery (capsules or split dose with food). Retest at competition intensity before using at a major event. Do not use for the first time at a high-stakes competition.')">Mild (manageable)</div>
            <div class="tree-option" onclick="showFinalResult('stop', 'Do not use in competition. Significant GI distress eliminates any performance benefit and creates catastrophic risk in a race setting. This athlete is a non-responder for standard protocols. Consider protocol modifications (capsules, food) in future training cycles.')">Significant (nausea/cramping)</div>
          </div>
        </div>
        <div id="treeResult" style="display:none"></div>
      </div>

      <!-- PRINCIPLES -->
      <div class="section-header" style="margin-top: 56px">
        <div class="section-eyebrow">// Core Principles</div>
        <h3 style="font-family: 'DM Serif Display', serif; font-size: 32px">What sophisticated use looks like</h3>
      </div>
      <div class="principles-list">
        <div class="principle-item">
          <div class="principle-num">01</div>
          <div class="principle-content">
            <div class="principle-title">Treat it as a candidate, not a standard</div>
            <div class="principle-text">Bicarbonate is not a default supplement for all middle-distance swimmers. It's a candidate intervention that must be validated for each individual. The average population effect does not predict individual response. Your job as coach is to generate athlete-specific evidence, not apply group averages.</div>
          </div>
        </div>
        <div class="principle-item">
          <div class="principle-num">02</div>
          <div class="principle-content">
            <div class="principle-title">Never first-time in competition</div>
            <div class="principle-text">This is the one absolute rule. No matter how compelling the evidence looks at the category level, the variability of individual response ‚Äî particularly GI response ‚Äî makes it irresponsible to introduce bicarbonate loading for the first time in a meaningful competition. There is no recovery from GI failure mid-race.</div>
          </div>
        </div>
        <div class="principle-item">
          <div class="principle-num">03</div>
          <div class="principle-content">
            <div class="principle-title">Individualize timing rigorously</div>
            <div class="principle-text">The 60‚Äì180 minute range of individual time-to-peak is not a minor footnote. An athlete who peaks at 150 minutes taking the supplement 60 minutes before a race is competing in a declining alkalotic state. Run 3‚Äì5 training sessions at competition intensity with varied ingestion windows to establish each athlete's personal peak. This is the most important practical variable in the entire protocol.</div>
          </div>
        </div>
        <div class="principle-item">
          <div class="principle-num">04</div>
          <div class="principle-content">
            <div class="principle-title">Hold the magnitude of benefit loosely</div>
            <div class="principle-text">The 1.3% average improvement is real but comes from a literature with significant methodological limitations ‚Äî small samples, blinding failures, non-elite populations. The true effect for your athlete in real competition conditions is unknown and unknowable from the existing research. Plan for benefit, but don't build performance targets around it.</div>
          </div>
        </div>
        <div class="principle-item">
          <div class="principle-num">05</div>
          <div class="principle-content">
            <div class="principle-title">Be skeptical of training use</div>
            <div class="principle-text">The trend toward using bicarbonate as a chronic training tool is ahead of the evidence. The only study directly examining whether bicarbonate-assisted training produces greater adaptation (Siegler, resistance training, 10 weeks) found no additional benefit. The theoretical concern ‚Äî that blunting metabolic acidosis reduces the adaptive signal ‚Äî is unresolved. Use bicarbonate for competition; treat its training use as genuinely experimental.</div>
          </div>
        </div>
        <div class="principle-item">
          <div class="principle-num">06</div>
          <div class="principle-content">
            <div class="principle-title">The right question to always ask</div>
            <div class="principle-text">For this specific athlete, in this specific context, is the average effect large enough and reliable enough to justify the probability and consequence of the downside? The evidence gives you the population average. The training trials give you individual response data. Your judgment integrates both with the competitive stakes. That's the complete framework.</div>
          </div>
        </div>
        <div class="principle-item">
          <div class="principle-num">07</div>
          <div class="principle-content">
            <div class="principle-title">Basics before optimization ‚Äî the Bowman priority order</div>
            <div class="principle-text">The most decorated coach in Olympic swimming history frames it this way: before worrying about sodium bicarbonate, make sure the athlete is properly hydrated, fueled with carbohydrates, and showing up to every practice. The same epistemological error ‚Äî reaching for edge optimization before the center is solid ‚Äî explains why clubs do power training with age groupers, why coaches rotate stroke focus before repetition builds stability, and why athletes take supplements before establishing baseline training consistency. Bicarbonate is not a shortcut. It is a precision tool that amplifies the performance of athletes who have already built the foundation it's supposed to augment.</div>
          </div>
        </div>
      </div>

      <!-- SUMMARY BOX -->
      <div style="background: rgba(0,212,255,0.05); border: 1px solid rgba(0,212,255,0.2); border-radius: 12px; padding: 40px; margin-top: 48px">
        <div class="mech-title">// The 20% that explains everything</div>
        <p style="font-family: 'DM Serif Display', serif; font-size: 22px; line-height: 1.5; margin-bottom: 20px; color: var(--text)">High-intensity swimming creates H‚Å∫ faster than the body clears it. Bicarbonate buys clearance capacity. The evidence for 200‚Äì400m events is real but built on imperfect data. GI risk is the central practical problem, not a footnote. Individual response varies enormously and predicting who benefits remains unsolved. Competition-condition validity is assumed, not demonstrated. Sophisticated programs individualize timing, validate GI tolerance in training, and hold the expected benefit loosely ‚Äî treating it as a tool that may help specific athletes in specific contexts, not a standard protocol for all middle-distance swimmers.</p>
        <div style="background: rgba(255,107,53,0.07); border-left: 3px solid var(--accent2); border-radius: 8px; padding: 20px 24px; margin-bottom: 24px">
          <p style="font-style: italic; color: var(--text-mid); font-size: 14px; line-height: 1.7; margin-bottom: 8px">"The research says it works and it does. But it works with a specific dose for a specific physiology at an incredibly specific time before a specific event. Before we worry about sodium bicarb, how about make the intervals on your main set ‚Äî or just show up to every practice."</p>
          <p style="font-family: 'DM Mono', monospace; font-size: 11px; color: var(--text-dim); letter-spacing: 1px">// Bob Bowman ‚Äî 38 Olympic medals, coach of Phelps ¬∑ Marchand ¬∑ McIntosh</p>
        </div>
        <div style="display: flex; gap: 12px; flex-wrap: wrap">
          <span class="tag tag-blue">Mechanism: Real</span>
          <span class="tag tag-green">200‚Äì400m: Supported</span>
          <span class="tag tag-orange">Elite Evidence: Weak</span>
          <span class="tag tag-red">GI Risk: Non-trivial</span>
          <span class="tag tag-blue">Individualization: Essential</span>
          <span class="tag tag-orange">Training Use: Unresolved</span>
          <span class="tag tag-red">Without Trials: Dart-Throw</span>
        </div>
      </div>
    </div>

  <div class="substack-cta">
    <div class="substack-cta-eyebrow">// Chlorinated Chronicles</div>
    <div class="substack-cta-title">More analysis like this,<br>straight to your <em>inbox</em></div>
    <p class="substack-cta-desc">Sports governance, policy analysis, and swimming industry insights ‚Äî written for coaches, scientists, and anyone who thinks seriously about the sport.</p>
    <a href="https://swimed.substack.com/" target="_blank" class="substack-cta-btn">
      <svg viewBox="0 0 24 24" fill="currentColor"><path d="M22.539 8.242H1.46V5.406h21.08v2.836zM1.46 10.812V24L12 18.11 22.54 24V10.812H1.46zM22.54 0H1.46v2.836h21.08V0z"/></svg>
      Subscribe on Substack ‚Äî it's free
    </a>
    <div class="substack-cta-note">Already a reader? <a href="https://swimed.substack.com/" target="_blank">swimed.substack.com</a> ¬∑ No spam, unsubscribe anytime</div>
  </div>
  </section>
  <section id="models" class="section">
    <div class="section-header">
      <div class="section-eyebrow">// Interactive Models</div>
      <h2 class="section-title">Biochemistry & Race<br>Simulation</h2>
      <p class="section-subtitle">Two live models: the full physiological mechanism from ingestion to ion transport, and a lap-by-lap race simulator with configurable athlete parameters.</p>
    </div>
    <div class="model-block">
    <div class="model-label">// Model 01</div>
    <h2 class="model-title">Biochemistry, Pharmacology<br>& Physiology</h2>
    <p class="model-desc">Four interactive layers ‚Äî from ingestion to ion transport. Start at the top and go deeper, or jump to any layer. Each layer builds on the one above.</p>

    <div class="panel">
      <div class="panel-header">
        <div class="panel-dot cyan"></div>
        <div class="panel-title">NaHCO‚ÇÉ ‚Äî Mechanism Explorer</div>
      </div>
      <div class="panel-body">

        <div class="layer-tabs">
          <button class="layer-tab active" onclick="showLayer('l1',this)">‚ë† Absorption</button>
          <button class="layer-tab orange" onclick="showLayer('l2',this)">‚ë° Blood pH</button>
          <button class="layer-tab green" onclick="showLayer('l3',this)">‚ë¢ Ion Transport</button>
          <button class="layer-tab purple" onclick="showLayer('l4',this)">‚ë£ Westerblad</button>
        </div>

        <!-- LAYER 1 ‚Äî ABSORPTION KINETICS -->
        <div class="layer-content active" id="l1">
          <div class="ctrl-row">
            <div class="ctrl-group">
              <div class="ctrl-label">Individual timing (min to peak HCO‚ÇÉ‚Åª)</div>
              <input type="range" id="peakTime" min="60" max="180" value="90" oninput="updateAbsorption()">
              <div class="ctrl-value" id="peakTimeVal">90 min</div>
            </div>
            <div class="ctrl-group">
              <div class="ctrl-label">Dose (g/kg body mass)</div>
              <input type="range" min="15" max="40" value="30" oninput="updateAbsorption()" id="doseRange">
              <div class="ctrl-value" id="doseVal">0.30 g/kg</div>
            </div>
            <div class="ctrl-group">
              <div class="ctrl-label">Delivery format</div>
              <select onchange="updateAbsorption()" id="delivery">
                <option value="solution">Solution in water</option>
                <option value="capsule" selected>Capsules</option>
                <option value="food">With CHO meal</option>
                <option value="split">Split dose</option>
              </select>
            </div>
          </div>
          <div class="canvas-wrap">
            <canvas id="absCanvas"></canvas>
          </div>
          <div class="legend">
            <div class="legend-item"><div class="legend-line" style="background:var(--accent)"></div>Blood [HCO‚ÇÉ‚Åª] mmol/L</div>
            <div class="legend-item"><div class="legend-line" style="background:var(--accent2); border-top: 2px dashed var(--accent2); background: none; width:24px; height:2px; border-bottom: none; border-left:none; border-right:none;"></div>Race window</div>
            <div class="legend-item"><div class="legend-line" style="background:var(--accent3)"></div>Baseline (no dose)</div>
          </div>
          <div class="info-grid">
            <div class="info-card">
              <div class="info-card-label">Peak [HCO‚ÇÉ‚Åª]</div>
              <div class="info-card-value" id="peakConc">29.4</div>
              <div class="info-card-sub">mmol/L (baseline ~24 mmol/L)</div>
            </div>
            <div class="info-card">
              <div class="info-card-label">Time to peak</div>
              <div class="info-card-value" id="timeToPeak">90 min</div>
              <div class="info-card-sub">Individual variation: 60‚Äì180 min</div>
            </div>
            <div class="info-card">
              <div class="info-card-label">GI risk</div>
              <div class="info-card-value danger" id="giRisk">Moderate</div>
              <div class="info-card-sub" id="giRiskSub">Capsules reduce peak load</div>
            </div>
            <div class="info-card">
              <div class="info-card-label">Buffer increase</div>
              <div class="info-card-value green" id="bufferInc">+22%</div>
              <div class="info-card-sub">Extracellular buffering capacity</div>
            </div>
          </div>
          <div class="deep-dive">
            <button class="deep-dive-toggle" onclick="toggleDeep('dd1')">// Deep dive: Absorption pharmacokinetics ‚ñæ</button>
            <div class="deep-dive-content" id="dd1">
              <p>Sodium bicarbonate dissociates immediately in gastric fluid: <strong>NaHCO‚ÇÉ ‚Üí Na‚Å∫ + HCO‚ÇÉ‚Åª</strong>. In the highly acidic stomach (pH ~1.5‚Äì3.5), bicarbonate is rapidly converted:</p>
              <div class="eqn">HCO‚ÇÉ‚Åª + H‚Å∫ ‚Üí H‚ÇÇCO‚ÇÉ ‚Üí H‚ÇÇO + CO‚ÇÇ‚Üë</div>
              <p>The CO‚ÇÇ produced drives the bloating and belching characteristic of bicarbonate ingestion. Absorption of the remaining bicarbonate and sodium ions occurs primarily in the <strong>small intestine</strong> via active transport and passive diffusion. Peak plasma [HCO‚ÇÉ‚Åª] typically occurs 60‚Äì90 min post-ingestion in most individuals ‚Äî but the range is 60‚Äì180 min, driven by differences in gastric emptying rate, gut motility, and baseline acid-base status.</p>
              <p><strong>Delivery format effects:</strong> Solution maximizes absorption rate but floods the GI tract with osmotic load. Capsules delay gastric emptying and distribute the bolus, reducing peak osmotic stress. Co-ingestion with a carbohydrate meal further slows absorption and reduces GI symptoms by diluting the bicarbonate bolus.</p>
              <p>The clinically important implication: an athlete who takes bicarbonate 60 minutes before their event but peaks at 150 minutes is competing in a <em>declining</em> alkalotic state ‚Äî potentially worse than no dose at all due to GI discomfort without physiological benefit.</p>
            </div>
          </div>
        </div>

        <!-- LAYER 2 ‚Äî BLOOD pH BUFFERING -->
        <div class="layer-content" id="l2">
          <div class="ctrl-row">
            <div class="ctrl-group">
              <div class="ctrl-label">Exercise intensity (% of max effort)</div>
              <input type="range" class="orange" id="intensity" min="70" max="100" value="90" oninput="updatepH()">
              <div class="ctrl-value orange" id="intensityVal">90%</div>
            </div>
            <div class="ctrl-group">
              <div class="ctrl-label">Duration (minutes)</div>
              <input type="range" class="orange" id="duration" min="1" max="8" value="2" oninput="updatepH()">
              <div class="ctrl-value orange" id="durationVal">2 min (200m)</div>
            </div>
          </div>
          <div class="canvas-wrap">
            <canvas id="phCanvas"></canvas>
          </div>
          <div class="legend">
            <div class="legend-item"><div class="legend-line" style="background:var(--danger)"></div>Without NaHCO‚ÇÉ ‚Äî blood pH</div>
            <div class="legend-item"><div class="legend-line" style="background:var(--accent)"></div>With NaHCO‚ÇÉ ‚Äî blood pH</div>
            <div class="legend-item"><div class="legend-line" style="background:var(--accent4); height:1px; border-top: 1px dashed var(--accent4); background: none;"></div>Fatigue threshold (~7.10)</div>
          </div>
          <div class="info-grid">
            <div class="info-card">
              <div class="info-card-label">pH at exhaustion (no bicarb)</div>
              <div class="info-card-value danger" id="phNoB">7.08</div>
              <div class="info-card-sub">Below 7.0 = severe acidosis</div>
            </div>
            <div class="info-card">
              <div class="info-card-label">pH at exhaustion (with bicarb)</div>
              <div class="info-card-value" id="phWithB">7.14</div>
              <div class="info-card-sub">Maintained above threshold longer</div>
            </div>
            <div class="info-card">
              <div class="info-card-label">Time above pH 7.10</div>
              <div class="info-card-value green" id="timeAbove">+18 sec</div>
              <div class="info-card-sub">Additional high-output capacity</div>
            </div>
          </div>
          <div class="deep-dive">
            <button class="deep-dive-toggle" onclick="toggleDeep('dd2')">// Deep dive: Henderson-Hasselbalch & buffering chemistry ‚ñæ</button>
            <div class="deep-dive-content" id="dd2">
              <p>Blood pH is governed by the Henderson-Hasselbalch equation:</p>
              <div class="eqn">pH = pK‚Çê + log([HCO‚ÇÉ‚Åª] / [CO‚ÇÇ]) &nbsp;&nbsp; pK‚Çê = 6.1</div>
              <p>During high-intensity exercise, glycolysis generates pyruvate faster than mitochondria can consume it. Pyruvate is converted to lactate, with co-release of H‚Å∫. This H‚Å∫ is initially buffered intracellularly (by phosphocreatine, inorganic phosphate, and proteins), then extracellularly by the bicarbonate system:</p>
              <div class="eqn">H‚Å∫ + HCO‚ÇÉ‚Åª ‚Üí H‚ÇÇCO‚ÇÉ ‚Üí H‚ÇÇO + CO‚ÇÇ (exhaled)</div>
              <p>By pre-loading extracellular [HCO‚ÇÉ‚Åª] from ~24 to ~29 mmol/L, bicarbonate loading <strong>steepens the H‚Å∫ concentration gradient</strong> between intracellular and extracellular compartments. This accelerates the efflux of H‚Å∫ from contracting muscle via MCT (monocarboxylate transporter) co-transport, delaying intracellular acidosis.</p>
              <p>The physiological fatigue threshold (pH ~7.0‚Äì7.10 in muscle) is not crossed as quickly, extending the time the athlete can sustain high glycolytic flux. <strong>This is the mechanistic basis of the performance benefit.</strong></p>
            </div>
          </div>
        </div>

        <!-- LAYER 3 ‚Äî ION TRANSPORT -->
        <div class="layer-content" id="l3">
          <p style="font-size:13px; color:var(--text-mid); line-height:1.7; margin-bottom:20px;">The muscle cell membrane is where the core mechanism operates. Hover each zone to explore the molecular events.</p>
          <div class="mech-diagram">
            <div class="mech-zone" style="background: rgba(255,71,87,0.04)">
              <div class="mech-zone-label">Inside muscle cell</div>
              <div class="mech-icon">üí™</div>
              <div class="particle-row">
                <div class="particle hplus">H‚Å∫</div>
                <div class="particle hplus">H‚Å∫</div>
                <div class="particle hplus">H‚Å∫</div>
              </div>
              <div class="mech-text">Glycolysis generates H‚Å∫ rapidly. Intracellular pH falls. Enzyme activity impaired.</div>
              <div class="mech-arrow">‚Üí</div>
            </div>
            <div class="mech-zone" style="background: rgba(0,212,255,0.04)">
              <div class="mech-zone-label">MCT4 co-transporter</div>
              <div class="mech-icon">üîÑ</div>
              <div class="particle-row">
                <div class="particle hplus">H‚Å∫</div>
                <div class="particle" style="background:rgba(255,255,255,0.1); border:1px solid #666; font-size:8px; color:#999; width:28px">lac‚Åª</div>
              </div>
              <div class="mech-text">MCT4 co-transports H‚Å∫ + lactate out of cell. Rate limited by extracellular [HCO‚ÇÉ‚Åª] gradient.</div>
              <div class="mech-arrow">‚Üí</div>
            </div>
            <div class="mech-zone" style="background: rgba(0,212,255,0.08)">
              <div class="mech-zone-label">Extracellular / Blood</div>
              <div class="mech-icon">ü©∏</div>
              <div class="particle-row">
                <div class="particle bicarb">HCO‚ÇÉ</div>
                <div class="particle bicarb">HCO‚ÇÉ</div>
                <div class="particle h2co3">H‚ÇÇCO‚ÇÉ</div>
              </div>
              <div class="mech-text">Elevated [HCO‚ÇÉ‚Åª] captures H‚Å∫ ‚Üí H‚ÇÇCO‚ÇÉ. Gradient maintained. More H‚Å∫ can exit cell.</div>
              <div class="mech-arrow">‚Üí</div>
            </div>
            <div class="mech-zone" style="background: rgba(168,255,120,0.04)">
              <div class="mech-zone-label">Lung / Exhalation</div>
              <div class="mech-icon">üí®</div>
              <div class="particle-row">
                <div class="particle co2">CO‚ÇÇ</div>
                <div class="particle co2">CO‚ÇÇ</div>
              </div>
              <div class="mech-text">H‚ÇÇCO‚ÇÉ ‚Üí H‚ÇÇO + CO‚ÇÇ. CO‚ÇÇ exhaled via lungs. System is self-clearing.</div>
            </div>
          </div>
          <div class="info-grid">
            <div class="info-card">
              <div class="info-card-label">Key transporter</div>
              <div class="info-card-value" style="font-size:16px">MCT1 / MCT4</div>
              <div class="info-card-sub">Monocarboxylate transporters. Rate increases with steeper H‚Å∫ gradient.</div>
            </div>
            <div class="info-card">
              <div class="info-card-label">Net effect</div>
              <div class="info-card-value green" style="font-size:16px">‚Üë H‚Å∫ efflux</div>
              <div class="info-card-sub">Intracellular pH stays higher for longer during glycolytic flux.</div>
            </div>
            <div class="info-card">
              <div class="info-card-label">Self-limiting factor</div>
              <div class="info-card-value orange" style="font-size:16px">‚Üë VCO‚ÇÇ</div>
              <div class="info-card-sub">Increased CO‚ÇÇ production drives hyperventilation. Limits at very high intensities.</div>
            </div>
          </div>
          <div class="deep-dive">
            <button class="deep-dive-toggle" onclick="toggleDeep('dd3')">// Deep dive: MCT kinetics & intracellular buffering ‚ñæ</button>
            <div class="deep-dive-content" id="dd3">
              <p>The key molecular actors are the <strong>MCT1 and MCT4 monocarboxylate transporters</strong>. MCT4 is the high-capacity efflux transporter in glycolytic (Type II) muscle fibers ‚Äî the fibers that dominate energy production in 200‚Äì400m swimming. Its transport rate is directly proportional to the transmembrane H‚Å∫ gradient.</p>
              <p>Pre-exercise bicarbonate loading raises extracellular [HCO‚ÇÉ‚Åª] from ~24 to ~28‚Äì30 mmol/L. This alkalizes the extracellular space, increasing the chemical gradient that drives H‚Å∫ efflux. The rate equation simplifies to:</p>
              <div class="eqn">J(H‚Å∫) ‚àù Vmax √ó [H‚Å∫]intracellular / ([H‚Å∫]intracellular + Km)</div>
              <p>By lowering extracellular [H‚Å∫] (raising pH), the denominator decreases and net flux increases. The practical result: the muscle can sustain higher glycolytic rates for longer before reaching the intracellular pH threshold that impairs contractile function.</p>
              <p><strong>Intracellular buffering systems:</strong> Phosphocreatine (first line), bicarbonate (limited intracellular), protein histidine residues (carnosine), and inorganic phosphate all contribute. Bicarbonate loading augments only the extracellular component ‚Äî it does not directly change intracellular buffer capacity. This is why it complements rather than replaces beta-alanine (which raises intracellular carnosine).</p>
            </div>
          </div>
        </div>

        <!-- LAYER 4 ‚Äî WESTERBLAD CHALLENGE -->
        <div class="layer-content" id="l4">
          <p style="font-size:13px; color:var(--text-mid); line-height:1.7; margin-bottom:20px;">The bicarbonate consensus rests on the H‚Å∫ fatigue hypothesis. Westerblad's work from Karolinska Institute challenges this at the mechanistic level.</p>

          <div class="toggle-row">
            <button class="toggle-btn" id="westBtn" onclick="toggleWesterblad()">Show Westerblad challenge</button>
            <span class="toggle-label">Tap to reveal the competing fatigue mechanism</span>
          </div>

          <div class="canvas-wrap">
            <canvas id="westCanvas"></canvas>
          </div>
          <div class="legend">
            <div class="legend-item"><div class="legend-line" style="background:var(--accent)"></div>H‚Å∫ accumulation (consensus mechanism)</div>
            <div class="legend-item"><div class="legend-line" style="background:var(--purple)"></div>Inorganic phosphate [Pi] rise</div>
            <div class="legend-item"><div class="legend-line" style="background:var(--accent2)"></div>Ca¬≤‚Å∫ transient amplitude (decline)</div>
          </div>

          <div class="westerblad-panel" id="westPanel">
            <div class="westerblad-title">// The Westerblad Challenge ‚Äî Karolinska Institute</div>
            <div class="westerblad-text">Hakan Westerblad's lab demonstrated that during repeated high-frequency stimulation, force decline correlates more strongly with <strong>inorganic phosphate [Pi] accumulation</strong> and <strong>Ca¬≤‚Å∫ transient amplitude reduction</strong> than with H‚Å∫ concentration per se. The mechanism:</div>
            <div class="particle-row" style="justify-content:flex-start; margin-bottom: 12px;">
              <div class="particle pi">Pi</div>
              <span style="font-size:12px; color:var(--text-mid); line-height:20px; margin-left:8px">Pi enters sarcoplasmic reticulum ‚Üí precipitates with Ca¬≤‚Å∫ as Ca‚ÇÇ(Pi) ‚Üí reduces Ca¬≤‚Å∫ available for troponin binding ‚Üí force declines independently of pH</span>
            </div>
            <div class="westerblad-text">Additionally, reduced Ca¬≤‚Å∫ sensitivity of contractile proteins under acidic conditions (the original H‚Å∫ hypothesis) has been shown to be largely reversed at physiological temperatures (~37¬∞C) ‚Äî meaning the H‚Å∫-inhibition effect seen in <em>in vitro</em> studies at room temperature may not translate fully to living muscle during exercise.</div>
            <div class="westerblad-verdict">
              <strong>What this means for bicarbonate:</strong> If Pi accumulation and Ca¬≤‚Å∫ handling are the dominant fatigue drivers, bicarbonate loading ‚Äî which targets H‚Å∫ ‚Äî may be addressing a secondary mechanism. This does not mean bicarbonate has no effect; it means the precise mechanistic explanation used to justify it may be incomplete. The performance data is real. The mechanism is contested. Practitioners should hold the theoretical rationale loosely.
            </div>
          </div>
          <div class="deep-dive" style="margin-top:16px">
            <button class="deep-dive-toggle" onclick="toggleDeep('dd4')">// Deep dive: Temperature-dependence & the H‚Å∫ controversy ‚ñæ</button>
            <div class="deep-dive-content" id="dd4">
              <p>The H‚Å∫ fatigue hypothesis dates to classic work by Fabiato & Fabiato (1978) and Donaldson & Hermansen (1978), showing that acidified solutions impaired Ca¬≤‚Å∫ sensitivity of isolated myofibrils. These studies were done at 12‚Äì22¬∞C.</p>
              <p>Westerblad and colleagues showed that at physiological temperature (35‚Äì37¬∞C), the inhibitory effect of H‚Å∫ on Ca¬≤‚Å∫ sensitivity is substantially reduced. The crossbridge kinetics change: the Q10 (temperature coefficient) means that what is true at 15¬∞C is not necessarily true at 37¬∞C. This complicates the foundational mechanistic argument.</p>
              <p>In contrast, <strong>inorganic phosphate</strong> ‚Äî released during ATP hydrolysis and PCr degradation ‚Äî does not show the same temperature-dependence. Pi inhibits crossbridge cycling and directly precipitates Ca¬≤‚Å∫ in the SR lumen. The Pi mechanism appears more robust across temperature ranges.</p>
              <p>The current mechanistic picture: fatigue in high-intensity exercise is likely <strong>multifactorial</strong>. H‚Å∫ contributes, but is not the sole or even dominant driver. Pi and Ca¬≤‚Å∫ handling are co-equal or superior mechanisms. Bicarbonate addresses the extracellular H‚Å∫ component, which remains a real contributor ‚Äî just perhaps not as primary as the original theory assumed.</p>
            </div>
          </div>
        </div>

      </div>
    </div>
  </div>

  <div class="divider"></div>

  <!-- ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
       MODEL 2 ‚Äî ELITE SWIMMER RACE SIMULATION
  ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê -->
  <div class="model-block">
    <div class="model-label">// Model 02</div>
    <h2 class="model-title">Elite Swimmer<br><em>Race Simulation</em></h2>
    <p class="model-desc">Configure your athlete, select an event, then activate NaHCO‚ÇÉ to see the lap-by-lap physiological and performance effect in real time.</p>

    <div class="panel">
      <div class="panel-header">
        <div class="panel-dot orange"></div>
        <div class="panel-title">Athlete Configuration & Race Model</div>
      </div>
      <div class="panel-body">

        <!-- ATHLETE SLIDERS -->
        <div class="athlete-config">
          <div class="ctrl-group">
            <div class="ctrl-label">Body weight (kg)</div>
            <input type="range" id="bw" min="50" max="100" value="75" oninput="updateAthlete()">
            <div class="ctrl-value" id="bwVal">75 kg</div>
          </div>
          <div class="ctrl-group">
            <div class="ctrl-label">VO‚ÇÇmax (ml/kg/min)</div>
            <input type="range" id="vo2" min="55" max="80" value="72" oninput="updateAthlete()">
            <div class="ctrl-value" id="vo2Val">72 ml/kg/min</div>
          </div>
          <div class="ctrl-group">
            <div class="ctrl-label">Training age (years elite)</div>
            <input type="range" id="tage" min="2" max="15" value="8" oninput="updateAthlete()">
            <div class="ctrl-value" id="tageVal">8 years elite</div>
          </div>
          <div class="ctrl-group">
            <div class="ctrl-label">Event</div>
            <select id="event" onchange="updateAthlete(); resetRace()">
              <option value="200free">200m Freestyle</option>
              <option value="400free">400m Freestyle</option>
              <option value="200im">200m Individual Medley</option>
            </select>
          </div>
          <div class="ctrl-group">
            <div class="ctrl-label">GI tolerance profile</div>
            <select id="gitol" onchange="updateAthlete()">
              <option value="good">Good (low risk)</option>
              <option value="moderate" selected>Moderate</option>
              <option value="poor">Poor (high risk)</option>
            </select>
          </div>
          <div class="ctrl-group">
            <div class="ctrl-label">Individualization status</div>
            <select id="indiv" onchange="updateAthlete()">
              <option value="yes" selected>Trialled & timed</option>
              <option value="no">First time use</option>
            </select>
          </div>
        </div>

        <!-- ATHLETE SUMMARY CHIPS -->
        <div class="stat-strip" style="margin-bottom:24px">
          <div class="stat-chip">
            <div class="stat-chip-label">NaHCO‚ÇÉ dose</div>
            <div class="stat-chip-val" id="chipDose">22.5g</div>
          </div>
          <div class="stat-chip">
            <div class="stat-chip-label">Expected gain</div>
            <div class="stat-chip-val green" id="chipGain">~1.2%</div>
          </div>
          <div class="stat-chip">
            <div class="stat-chip-label">GI failure risk</div>
            <div class="stat-chip-val orange" id="chipGI">Moderate</div>
          </div>
          <div class="stat-chip">
            <div class="stat-chip-label">Buffering profile</div>
            <div class="stat-chip-val" id="chipBuff">High trained</div>
          </div>
        </div>

        <!-- ACTIVATE BUTTON -->
        <button class="activate-btn" id="activateBtn" onclick="startRace()">
          <div class="btn-dot" id="btnDot"></div>
          <span id="btnText">‚ö° ACTIVATE NaHCO‚ÇÉ ‚Äî RUN RACE SIMULATION</span>
        </button>

        <!-- RACE CANVAS ‚Äî pH/Lactate curves -->
        <div class="race-panel">
          <div class="race-panel-title">// Physiological Trace ‚Äî pH & Blood Lactate by Lap</div>
          <div class="race-canvas-wrap">
            <canvas id="racePhCanvas"></canvas>
          </div>
          <div class="legend">
            <div class="legend-item"><div class="legend-line" style="background:var(--danger)"></div>pH ‚Äî No NaHCO‚ÇÉ</div>
            <div class="legend-item"><div class="legend-line" style="background:var(--accent)"></div>pH ‚Äî With NaHCO‚ÇÉ</div>
            <div class="legend-item"><div class="legend-line" style="background:var(--accent4)"></div>Blood lactate (mmol/L) ‚Äî No NaHCO‚ÇÉ</div>
            <div class="legend-item"><div class="legend-line" style="background:var(--accent3)"></div>Blood lactate (mmol/L) ‚Äî With NaHCO‚ÇÉ</div>
          </div>
        </div>

        <!-- LAP TABLE -->
        <div class="race-panel">
          <div class="race-panel-title">// Lap Split Comparison</div>
          <table class="lap-table" id="lapTable">
            <thead>
              <tr>
                <th>Lap</th>
                <th>Stroke / Leg</th>
                <th>Split ‚Äî No NaHCO‚ÇÉ</th>
                <th>Split ‚Äî With NaHCO‚ÇÉ</th>
                <th>Œî</th>
                <th>Mechanism</th>
              </tr>
            </thead>
            <tbody id="lapBody">
              <!-- populated by JS -->
            </tbody>
          </table>
        </div>

        <!-- FINAL STATS -->
        <div class="stat-strip" id="finalStats" style="display:none">
          <div class="stat-chip">
            <div class="stat-chip-label">Total time ‚Äî no bicarb</div>
            <div class="stat-chip-val danger" id="finalNoB">‚Äî</div>
          </div>
          <div class="stat-chip">
            <div class="stat-chip-label">Total time ‚Äî with bicarb</div>
            <div class="stat-chip-val green" id="finalWithB">‚Äî</div>
          </div>
          <div class="stat-chip">
            <div class="stat-chip-label">Time saved</div>
            <div class="stat-chip-val green" id="finalDiff">‚Äî</div>
          </div>
          <div class="stat-chip">
            <div class="stat-chip-label">% improvement</div>
            <div class="stat-chip-val green" id="finalPct">‚Äî</div>
          </div>
          <div class="stat-chip">
            <div class="stat-chip-label">Peak lactate ‚Äî no bicarb</div>
            <div class="stat-chip-val danger" id="finalLacNo">‚Äî</div>
          </div>
          <div class="stat-chip">
            <div class="stat-chip-label">Peak lactate ‚Äî with bicarb</div>
            <div class="stat-chip-val green" id="finalLacYes">‚Äî</div>
          </div>
        </div>

        <!-- GI WARNING if poor tolerance + no trialling -->
        <div id="giWarning" style="display:none; background:rgba(255,71,87,0.08); border:1px solid rgba(255,71,87,0.3); border-radius:10px; padding:16px 20px; margin-top:16px">
          <div style="font-family:'DM Mono',monospace; font-size:10px; letter-spacing:3px; color:var(--danger); margin-bottom:8px">// RISK FLAG</div>
          <div style="font-size:13px; color:var(--text-mid); line-height:1.7" id="giWarningText"></div>
        </div>

      </div>
    </div>
  </div>

  <div class="substack-cta">
    <div class="substack-cta-eyebrow">// Chlorinated Chronicles</div>
    <div class="substack-cta-title">More analysis like this,<br>straight to your <em>inbox</em></div>
    <p class="substack-cta-desc">Sports governance, policy analysis, and swimming industry insights ‚Äî written for coaches, scientists, and anyone who thinks seriously about the sport.</p>
    <a href="https://swimed.substack.com/" target="_blank" class="substack-cta-btn">
      <svg viewBox="0 0 24 24" fill="currentColor"><path d="M22.539 8.242H1.46V5.406h21.08v2.836zM1.46 10.812V24L12 18.11 22.54 24V10.812H1.46zM22.54 0H1.46v2.836h21.08V0z"/></svg>
      Subscribe on Substack ‚Äî it's free
    </a>
    <div class="substack-cta-note">Already a reader? <a href="https://swimed.substack.com/" target="_blank">swimed.substack.com</a> ¬∑ No spam, unsubscribe anytime</div>
  </div>
  </section>
</div>

<script>
// ‚îÄ‚îÄ SPLASH ‚îÄ‚îÄ
function enterApp() {
  document.getElementById('splash').classList.add('out');
  setTimeout(() => {
    document.getElementById('splash').style.display = 'none';
    const app = document.getElementById('app');
    app.classList.add('visible');
    animateBars();
  }, 800);
}

// ‚îÄ‚îÄ NAVIGATION ‚îÄ‚îÄ
function showSection(id, btn) {
  // Init models canvases when models tab first opened
  if (id === 'models') { setTimeout(initModels, 50); }
  document.querySelectorAll('.section').forEach(s => s.classList.remove('active'));
  document.querySelectorAll('.nav-btn').forEach(b => b.classList.remove('active'));
  document.getElementById(id).classList.add('active');
  btn.classList.add('active');
  if (id === 'evidence') setTimeout(animateBars, 100);
}

// ‚îÄ‚îÄ TABS ‚îÄ‚îÄ
function showTab(id, btn) {
  const parent = btn.closest('.section') || document.body;
  const tabBtns = btn.closest('.tab-bar').querySelectorAll('.tab-btn');
  tabBtns.forEach(b => b.classList.remove('active'));
  btn.classList.add('active');
  // find sibling tab-contents
  const container = btn.closest('.tab-bar').parentElement;
  container.querySelectorAll('.tab-content').forEach(c => c.classList.remove('active'));
  document.getElementById(id).classList.add('active');
  if (id === 'ev-strength') animateBars();
}

// ‚îÄ‚îÄ EVIDENCE BARS ‚îÄ‚îÄ
function animateBars() {
  setTimeout(() => {
    document.querySelectorAll('.evidence-bar-fill').forEach(bar => {
      bar.classList.add('animate');
    });
  }, 100);
}

// ‚îÄ‚îÄ DISTANCE MATRIX ‚îÄ‚îÄ
const distInfo = {
  '50m': { level: 'none', text: '<strong style="color:var(--danger)">No reliable evidence of benefit.</strong> The 50m event lasts 22‚Äì28 seconds at elite level. Meaningful anaerobic glycolytic contribution and significant H‚Å∫ accumulation simply don\'t develop within that window. The event is over before bicarbonate\'s mechanism has any meaningful time to operate. <em>Recommendation: Do not use.</em>' },
  '100m': { level: 'low', text: '<strong style="color:var(--warning)">Borderline / inconsistent evidence.</strong> The 100m (46‚Äì58s) sits in the transition zone. Meta-analysis shows no significant effect for 100m/100-yard events. Some individual studies show marginal benefits, particularly in the final section of the race. The beta-alanine + bicarbonate stack may improve the probability of benefit here. <em>Recommendation: Only with established individual response and validated protocol. High uncertainty.</em>' },
  '200m': { level: 'high', text: '<strong style="color:var(--accent3)">Strongest evidence of benefit.</strong> The 200m (approximately 1:45‚Äì2:10 at elite level) is squarely within the optimal window for bicarbonate. Meta-analysis shows significant effect (SMD: -0.22, p<0.001). One controlled study found ~1.8s improvement on average. This is the primary target event. <em>Recommendation: Appropriate for use if individual response validated and GI tolerance confirmed.</em>' },
  '400m': { level: 'high', text: '<strong style="color:var(--accent3)">Strong evidence of benefit.</strong> The 400m (3:40‚Äì4:30) is also within the effective window. Meta-analysis confirms significant benefit. The event duration means acidosis accumulation is substantial and the buffering advantage has more time to manifest. One study showed ~0.6% improvement. <em>Recommendation: Appropriate for use with same caveats as 200m. Strong candidate event.</em>' },
  '800m+': { level: 'low', text: '<strong style="color:var(--warning)">Diminishing returns / mixed evidence.</strong> Events beyond 800m shift increasingly toward aerobic metabolism. H‚Å∫ accumulation is less acute, and the bicarbonate buffer is largely exhausted before the race ends. Some evidence of benefit in the middle phases of longer events, but not consistently enough to recommend standard use. <em>Recommendation: Not a priority. Individual response testing warranted before consideration.</em>' }
};

function showDistDetail(el, event, level) {
  document.querySelectorAll('.matrix-cell').forEach(c => c.style.opacity = '0.5');
  el.style.opacity = '1';
  const detail = document.getElementById('distDetail');
  const info = distInfo[event];
  detail.innerHTML = info.text;
  detail.style.borderColor = level === 'high' ? 'rgba(168,255,120,0.3)' : level === 'low' ? 'rgba(255,211,42,0.3)' : 'rgba(255,71,87,0.3)';
}

// ‚îÄ‚îÄ DOSE CALCULATOR ‚îÄ‚îÄ
function calcDose() {
  const bw = parseFloat(document.getElementById('bodyWeight').value);
  const gi = document.getElementById('giTolerance').value;
  const dist = document.getElementById('eventDist').value;
  const peak = document.getElementById('peakTime').value;
  if (!bw || !gi || !dist) { document.getElementById('calcOutput').style.display = 'none'; return; }

  const dose = (bw * 0.3).toFixed(1);
  const ingestTime = peak || '90';
  let gain, riskClass, riskText;

  if (dist === '50') { gain = '0%'; riskClass = 'risk-high'; riskText = '‚ö†Ô∏è This event is outside the effective window for bicarbonate. The 50m is too short for meaningful H‚Å∫ accumulation. Use is not recommended regardless of GI tolerance.' }
  else if (dist === '100') { gain = '~0.3‚Äì0.8%'; riskClass = 'risk-med'; riskText = '‚ö° The 100m is borderline. Evidence is inconsistent. Only use if individual training trials have shown clear, reproducible benefit with this athlete. High uncertainty in expected gain.' }
  else if (dist === '200') { gain = '~1.0‚Äì1.5%'; riskClass = gi === 'good' ? 'risk-low' : gi === 'moderate' ? 'risk-med' : 'risk-high'; riskText = gi === 'good' ? '‚úì Optimal event for bicarbonate use. Good GI tolerance noted. Proceed with standard protocol. Validate timing in training before competition deployment.' : gi === 'moderate' ? '‚ö° Moderate GI symptoms warrant delivery format adjustment (capsules or split dose with food). Retest before major competition.' : '‚ö†Ô∏è Significant GI tolerance issues make competition use high-risk. The probability of GI distress eliminating any performance gain ‚Äî or worse ‚Äî is non-trivial.' }
  else if (dist === '400') { gain = '~0.5‚Äì0.8%'; riskClass = gi === 'good' ? 'risk-low' : gi === 'moderate' ? 'risk-med' : 'risk-high'; riskText = gi === 'good' ? '‚úì Strong candidate event for bicarbonate use. Good GI tolerance confirmed. Standard protocol appropriate.' : gi === 'moderate' ? '‚ö° Consider modified delivery. Monitor closely during race-simulation training sessions.' : '‚ö†Ô∏è High GI risk. Not recommended without protocol modification and retesting.' }
  else { gain = '<0.5%'; riskClass = 'risk-high'; riskText = '‚ö†Ô∏è Evidence is weak and inconsistent for events of this duration. Aerobic metabolism dominates; bicarbonate\'s buffering advantage is largely irrelevant. Use is not recommended.' }

  document.getElementById('doseGrams').textContent = dose + 'g';
  document.getElementById('ingestTime').textContent = ingestTime + ' min';
  document.getElementById('expectedGain').textContent = gain;
  const riskEl = document.getElementById('riskNote');
  riskEl.className = 'risk-bar ' + riskClass;
  riskEl.textContent = riskText;
  document.getElementById('calcOutput').style.display = 'block';
}

// ‚îÄ‚îÄ GI METER ‚îÄ‚îÄ
function setMeter(pct, note) {
  document.getElementById('meterNeedle').style.left = pct + '%';
  document.getElementById('meterNote').textContent = note;
}

// ‚îÄ‚îÄ RESEARCHERS DATA ‚îÄ‚îÄ
const researchers = [
  { name: 'Louise Burke', inst: 'Australian Catholic University', stance: 'pro', stanceLabel: 'Pro ‚Äî Pragmatic', bio: 'The most globally cited voice in applied sports nutrition. Burke established bicarbonate as one of a small number of supplements with genuine evidence, and developed the practical framing around implementation considerations ‚Äî dose, timing, and delivery format. Her approach is measured: she acknowledges individual variability while maintaining the supplement has a legitimate place in elite programs. Instrumental in getting bicarbonate included in IOC consensus recommendations.' },
  { name: 'Bryan Saunders', inst: 'University of S√£o Paulo', stance: 'nuanced', stanceLabel: 'Nuanced ‚Äî Insider Critic', bio: 'One of the most prolific current researchers and co-lead on the 2021 ISSN position stand. What distinguishes Saunders is that he has also produced honest skeptical work ‚Äî including studies demonstrating that bicarbonate does not consistently improve high-intensity exercise capacity and that within-individual variability is large enough to seriously complicate single-trial conclusions. Strongly pro-bicarbonate as a category, but rigorous about the ways the literature oversimplifies it. His work on individual timing variation has been highly influential.' },
  { name: 'Guilherme Artioli', inst: 'Manchester Metropolitan University', stance: 'pro', stanceLabel: 'Pro ‚Äî Mechanistic', bio: 'Closely linked with Saunders and the S√£o Paulo research group. Has done significant work on both bicarbonate and beta-alanine, including the key studies examining whether combining the two produces additive effects for swimming performance. Mechanistically oriented ‚Äî interested in understanding exactly how and when bicarbonate works rather than just whether it does. His work tends to support the consensus position while adding nuance around conditions under which it holds.' },
  { name: 'Lars McNaughton', inst: 'Edge Hill University', stance: 'pro', stanceLabel: 'Pro ‚Äî Foundational', bio: 'A foundational figure publishing on bicarbonate since the 1990s. His reviews are among the most-cited entry points into the literature. McNaughton occupies a firmly pro-bicarbonate position ‚Äî his 2008 review "Ergogenic Effects of Sodium Bicarbonate" became a landmark reference. His work helped cement the 0.3 g/kg dosing standard the field now uses, and he has studied practical implementation including individualized timing protocols for swimmers specifically.' },
  { name: 'Jason Siegler', inst: 'Arizona State University', stance: 'nuanced', stanceLabel: 'Nuanced ‚Äî Applied', bio: 'A prolific collaborator whose work is most directly relevant to swimming coaches. Conducted key repeated-sprint swimming studies showing benefits emerging in later sprints of training sets. Importantly, his research also examined whether acute fatigue attenuation from bicarbonate translates into greater training adaptations over 10 weeks ‚Äî and found it does not. This quietly undermines one of the key justifications for using it chronically in training, making Siegler an important moderating voice.' },
  { name: 'Jozo Grgic', inst: 'Victoria University, Melbourne', stance: 'pro', stanceLabel: 'Pro ‚Äî Consensus Author', bio: 'Lead author on the 2021 ISSN position stand, which is the current authoritative consensus document. Primarily a review and meta-analysis researcher. His umbrella review applied GRADE criteria to the evidence ‚Äî an honest evidence-quality framework that rated some findings as only "moderate" certainty. This nuance tends to be lost when the consensus conclusions are cited downstream without attention to the confidence ratings attached to them.' },
  { name: 'Hakan Westerblad', inst: 'Karolinska Institute', stance: 'skeptical', stanceLabel: 'Mechanism Skeptic', bio: 'Not primarily a bicarbonate researcher, but his muscle physiology work is the most important scientific challenge to the consensus narrative. Westerblad has demonstrated that H‚Å∫ accumulation may not be the dominant driver of contractile failure during high-intensity exercise ‚Äî pointing instead to inorganic phosphate and calcium handling disruption. If H‚Å∫ is not the primary fatigue mechanism, bicarbonate\'s theoretical rationale becomes less clean. His work is acknowledged in the mainstream literature and then largely set aside.' },
  { name: 'ISSN', inst: 'International Society of Sports Nutrition', stance: 'pro', stanceLabel: 'Institutional ‚Äî Endorsing', bio: 'The most authoritative body producing consensus statements on this topic. The 2021 position stand is the document practitioners cite most often. The ISSN takes an evidence-based but relatively permissive stance on legal ergogenic aids. Worth noting: several position stand authors disclosed consulting relationships with the supplement industry (declared in the paper, not for bicarbonate specifically). This doesn\'t invalidate the science but is part of the context for how consensus gets framed and communicated.' },
  { name: 'IOC Medical Commission', inst: 'International Olympic Committee', stance: 'pro', stanceLabel: 'Institutional ‚Äî Endorsing', bio: 'The IOC\'s 2018 consensus statement on dietary supplements explicitly endorsed sodium bicarbonate as evidence-based for high-performance athletes. This formal institutional stamp is what most national federations and elite programs treat as authoritative. The IOC\'s position aligns with the ISSN ‚Äî cautiously supportive, acknowledging side effects, recommending individualization. Its endorsement has significantly increased adoption in elite swimming programs globally.' },
  { name: 'Bob Bowman', inst: 'University of Texas / Former ASU / Michael Phelps Coach', stance: 'nuanced', stanceLabel: 'Practitioner ‚Äî Precision Skeptic', bio: 'The most decorated swimming coach in Olympic history (38 Olympic medals, coach of Michael Phelps, L√©on Marchand, Summer McIntosh). Bowman has been explicit on the record that the science is real ‚Äî "The research says it works and it does" ‚Äî but frames practical use as requiring precision that most programs cannot deliver: a specific dose for a specific physiology at a specific time before a specific event. His dart-throw metaphor is exact: using bicarbonate without individualized timing trials is "standing back here and throwing a dart at a bullseye two rooms away." Critically, he and Paul Bergen were using it in elite programs in the 1990s ‚Äî his skepticism is practitioner-experience skepticism, not scientific denial. His coaching-priorities argument is equally important: before worrying about sodium bicarbonate, make sure your athlete is hydrated, fueled with carbohydrates, and showing up to every practice. Optimization around the edges before the center is solid is the error he is diagnosing.' }
];

function renderResearchers() {
  const grid = document.getElementById('researcherGrid');
  grid.innerHTML = researchers.map((r, i) => `
    <div class="researcher-card" id="rc${i}">
      <div class="researcher-name">${r.name}</div>
      <div class="researcher-inst">${r.inst}</div>
      <span class="researcher-stance stance-${r.stance}">${r.stanceLabel}</span>
      <div class="researcher-bio" id="rbio${i}">${r.bio}</div>
      <button class="expand-btn" onclick="toggleResearcher(${i})">Read more ‚Üí</button>
    </div>
  `).join('');
}

function toggleResearcher(i) {
  const card = document.getElementById(`rc${i}`);
  const bio = document.getElementById(`rbio${i}`);
  const btn = card.querySelector('.expand-btn');
  card.classList.toggle('expanded');
  btn.textContent = card.classList.contains('expanded') ? 'Read less ‚Üë' : 'Read more ‚Üí';
}

// ‚îÄ‚îÄ GAPS DATA ‚îÄ‚îÄ
const gaps = [
  { icon: 'üé≠', title: 'The Blinding / Expectancy Problem', text: 'Studies are nominally double-blind but functionally single-blind. Athletes detect the active treatment through GI symptoms and physiological sensation. Expectancy alone can produce 1‚Äì2% performance improvements ‚Äî precisely the magnitude bicarbonate produces. The true pharmacological contribution is likely smaller than the literature reports.' },
  { icon: '‚ôÄÔ∏è', title: 'The Female Athlete Gap', text: 'Only ~20% of studies include women. Female-specific analyses show inconsistent results ‚Äî some studies find no benefit at all. Hormonal fluctuations across the menstrual cycle affect acid-base homeostasis. The entire dosing and timing framework may need revision for female athletes. The advice coaches give to female swimmers is extrapolated from male data.' },
  { icon: 'üß¨', title: 'Individual Response Prediction', text: 'Variability in response is treated as noise rather than the central phenomenon. What predicts whether an athlete is a high-responder? Baseline blood bicarbonate? Muscle fiber type composition? Gut microbiome? Training age? These are scientifically tractable questions that remain completely unanswered.' },
  { icon: 'üìÖ', title: 'Chronic Use & Long-Term Adaptation', text: 'Almost every study is acute. What happens to natural buffering capacity if bicarbonate is used heavily across a competitive season? Does chronic use change the dose-response relationship? Does the gut adapt? The only relevant study (Siegler, 10 weeks) found no additional training adaptation. Everything else is assumption.' },
  { icon: 'üß†', title: 'Central / Perceptual Mechanisms', text: 'Several studies show bicarbonate reduces RPE beyond what peripheral acid-base changes predict. The artistic swimming study found significantly lower perceived exertion independent of lactate differences. If bicarbonate is partly working through central nervous system or perceptual mechanisms, optimal use timing and protocol may differ from the peripheral buffering model.' },
  { icon: '‚õ∞Ô∏è', title: 'Altitude & Hypoxic Training Interaction', text: 'High-altitude training creates its own acid-base disruption ‚Äî respiratory alkalosis followed by complex metabolic changes. Whether bicarbonate interacts with, complements, or undermines these effects is completely unstudied. Given that elite programs routinely combine altitude camps with peak preparation, this is a gap with real practical stakes.' },
  { icon: 'üèüÔ∏è', title: 'Competition-Condition Validity', text: 'Zero studies conducted in actual competition. Stress hormones differ. Pacing changes. GI motility is altered by cortisol and adrenaline ‚Äî exactly the mechanism by which bicarbonate causes problems. The translation from Tuesday-morning lab time trial to Olympic final is an assumption the field has never tested.' },
  { icon: 'üë∂', title: 'Youth Developmental Effects', text: 'Youth physiology studies show the same acute mechanism operates. But chronic use during development is completely unstudied. Does repeated acute alkalosis during adolescence affect natural buffering development? Does introducing supplement culture early shape risk behavior later? These questions have no evidence base.' }
];

function renderGaps() {
  const grid = document.getElementById('gapsGrid');
  grid.innerHTML = gaps.map(g => `
    <div class="gap-card">
      <div class="gap-icon">${g.icon}</div>
      <div class="gap-title">${g.title}</div>
      <div class="gap-text">${g.text}</div>
    </div>
  `).join('');
}

// ‚îÄ‚îÄ DECISION TREE ‚îÄ‚îÄ
let treeState = {};
function treeSelect(el, key, val) {
  const parent = el.closest('[id^="treeQ"]');
  parent.querySelectorAll('.tree-option').forEach(o => o.classList.remove('selected'));
  el.classList.add('selected');
  treeState[key] = val;

  if (key === 'event') {
    document.getElementById('treeQ2').style.display = 'none';
    document.getElementById('treeQ3').style.display = 'none';
    document.getElementById('treeResult').style.display = 'none';

    if (val === '200-400') {
      setTimeout(() => { document.getElementById('treeQ2').style.display = 'block'; }, 200);
    } else if (val === '50-100') {
      showFinalResult('caution', 'Borderline event. Evidence is inconsistent for 100m and absent for 50m. Only consider for 100m if the athlete has shown clear individual response in training trials and GI tolerance is excellent. The risk-benefit calculation is much less favorable than for 200‚Äì400m events.');
    } else if (val === '800+') {
      showFinalResult('stop', 'Not recommended. Evidence for 800m+ events is weak and inconsistent. The aerobic energy system dominates at this duration; bicarbonate\'s buffering advantage has limited scope. Training time is better spent on other performance interventions.');
    } else if (val === 'training') {
      showFinalResult('caution', 'Proceed with significant caution. Chronic training use is ahead of the evidence. The only direct study (Siegler, 10 weeks) found no additional training adaptation. Theoretical concern: blunting metabolic acidosis may reduce the adaptive signal that drives buffering system development. Treat any training use as genuinely experimental and monitor adaptation markers.');
    }
  }

  if (key === 'trials') {
    document.getElementById('treeQ3').style.display = 'none';
    document.getElementById('treeResult').style.display = 'none';

    if (val === 'yes') {
      setTimeout(() => { document.getElementById('treeQ3').style.display = 'block'; }, 200);
    } else {
      showFinalResult('caution', 'Do not use in competition yet. Complete individualized timing trials first: 3‚Äì5 training sessions at competition intensity with varied ingestion windows (60, 90, 120+ minutes). Establish personal time-to-peak and GI tolerance profile. Return to this decision tool when trials are complete. Skipping this step means deploying an unvalidated protocol in a high-stakes context.');
    }
  }
}

function showFinalResult(type, text) {
  const result = document.getElementById('treeResult');
  result.style.display = 'block';
  result.className = 'tree-result result-' + (type === 'proceed' ? 'proceed' : type === 'caution' ? 'caution' : 'stop');
  const icon = type === 'proceed' ? '‚úì' : type === 'caution' ? '‚ö°' : '‚úó';
  result.innerHTML = `<strong>${icon} ${type.charAt(0).toUpperCase() + type.slice(1)}:</strong> ${text}`;
  result.scrollIntoView({ behavior: 'smooth', block: 'nearest' });
}

// ‚îÄ‚îÄ INIT ‚îÄ‚îÄ
renderResearchers();
renderGaps();


function initModels() {
  if (window._modelsInitDone) return;
  window._modelsInitDone = true;
  document.querySelectorAll('canvas').forEach(c => resizeCanvas(c));
  updateAbsorption();
  updatepH();
  drawWesterblad();
  updateAthlete();
  buildLapTable();
  clearRaceCanvas();
}

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
// INTERACTIVE MODELS ‚Äî JavaScript
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
// UTILITY
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
function resizeCanvas(canvas) {
  const wrap = canvas.parentElement;
  canvas.width = wrap.clientWidth;
  canvas.height = wrap.clientHeight;
}

function showLayer(id, btn) {
  document.querySelectorAll('.layer-content').forEach(l => l.classList.remove('active'));
  document.querySelectorAll('.layer-tab').forEach(b => b.classList.remove('active'));
  document.getElementById(id).classList.add('active');
  btn.classList.add('active');
}

function toggleDeep(id) {
  const el = document.getElementById(id);
  el.classList.toggle('show');
}

function fmt(n, decimals=2) {
  return n.toFixed(decimals);
}

function fmtTime(s) {
  const m = Math.floor(s/60);
  const sec = (s % 60).toFixed(2);
  return m > 0 ? `${m}:${sec < 10 ? '0' : ''}${sec}` : `${sec}s`;
}

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
// LAYER 1 ‚Äî ABSORPTION KINETICS
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
function updateAbsorption() {
  const peakT = parseInt(document.getElementById('peakTime').value);
  const dose = parseInt(document.getElementById('doseRange').value)/100;
  const delivery = document.getElementById('delivery').value;

  document.getElementById('peakTimeVal').textContent = peakT + ' min';
  document.getElementById('doseVal').textContent = dose.toFixed(2) + ' g/kg';

  // GI risk
  const giMap = {
    solution: { label: 'High', sub: 'Rapid osmotic load', cls: 'danger' },
    capsule:  { label: 'Moderate', sub: 'Capsules reduce peak load', cls: 'orange' },
    food:     { label: 'Low‚ÄìModerate', sub: 'Food slows absorption', cls: 'orange' },
    split:    { label: 'Low', sub: 'Split dose spreads load', cls: 'green' }
  };
  const gi = giMap[delivery];
  const giEl = document.getElementById('giRisk');
  giEl.textContent = gi.label;
  giEl.className = 'info-card-value ' + gi.cls;
  document.getElementById('giRiskSub').textContent = gi.sub;

  // Buffer increase based on dose
  const bufPct = Math.round((dose / 0.3) * 22);
  document.getElementById('bufferInc').textContent = '+' + bufPct + '%';

  const peakConc = 24 + (dose / 0.3) * 5.4;
  document.getElementById('peakConc').textContent = peakConc.toFixed(1);
  document.getElementById('timeToPeak').textContent = peakT + ' min';

  drawAbsorption(peakT, dose, delivery);
}

function drawAbsorption(peakT, dose, delivery) {
  const canvas = document.getElementById('absCanvas');
  resizeCanvas(canvas);
  const ctx = canvas.getContext('2d');
  const W = canvas.width, H = canvas.height;
  ctx.clearRect(0, 0, W, H);

  const pad = { top: 30, right: 30, bottom: 50, left: 55 };
  const gw = W - pad.left - pad.right;
  const gh = H - pad.top - pad.bottom;
  const totalTime = 240; // minutes on x-axis
  const baseline = 24, maxConc = baseline + (dose/0.3)*5.4;

  // Grid
  ctx.strokeStyle = 'rgba(255,255,255,0.05)';
  ctx.lineWidth = 1;
  for (let i = 0; i <= 5; i++) {
    const y = pad.top + (i/5)*gh;
    ctx.beginPath(); ctx.moveTo(pad.left, y); ctx.lineTo(pad.left+gw, y); ctx.stroke();
  }
  for (let i = 0; i <= 6; i++) {
    const x = pad.left + (i/6)*gw;
    ctx.beginPath(); ctx.moveTo(x, pad.top); ctx.lineTo(x, pad.top+gh); ctx.stroke();
  }

  // Axes labels
  ctx.fillStyle = '#6b7d8f';
  ctx.font = '10px DM Mono';
  ctx.textAlign = 'right';
  const concRange = [20, 22, 24, 26, 28, 30, 32];
  concRange.forEach((v,i) => {
    const y = pad.top + gh - (v-20)/(32-20)*gh;
    ctx.fillText(v, pad.left - 8, y + 3);
  });
  ctx.textAlign = 'center';
  [0,40,80,120,160,200,240].forEach((v,i) => {
    const x = pad.left + (v/totalTime)*gw;
    ctx.fillText(v+'m', x, pad.top+gh+18);
  });

  // Axis labels
  ctx.save();
  ctx.translate(16, pad.top + gh/2);
  ctx.rotate(-Math.PI/2);
  ctx.fillStyle = '#9aacbc';
  ctx.font = '11px Instrument Sans';
  ctx.textAlign = 'center';
  ctx.fillText('[HCO‚ÇÉ‚Åª] mmol/L', 0, 0);
  ctx.restore();
  ctx.fillStyle = '#9aacbc';
  ctx.textAlign = 'center';
  ctx.fillText('Time (minutes)', pad.left + gw/2, H - 8);

  // toY helper
  const toY = v => pad.top + gh - (v - 20)/(32-20)*gh;
  const toX = t => pad.left + (t/totalTime)*gw;

  // Baseline flat line
  ctx.strokeStyle = 'rgba(168,255,120,0.5)';
  ctx.lineWidth = 1.5;
  ctx.setLineDash([4,4]);
  ctx.beginPath();
  ctx.moveTo(pad.left, toY(24));
  ctx.lineTo(pad.left+gw, toY(24));
  ctx.stroke();
  ctx.setLineDash([]);

  // Delivery factor (shape of curve)
  const delayFactor = { solution: 0.7, capsule: 1.0, food: 1.2, split: 1.3 }[delivery];

  // Bicarbonate curve (with dose)
  ctx.strokeStyle = 'rgba(0,212,255,0.9)';
  ctx.lineWidth = 2.5;
  ctx.beginPath();
  const pts = [];
  for (let t = 0; t <= totalTime; t += 2) {
    let conc;
    const effPeak = peakT * delayFactor;
    if (t < 10) {
      conc = baseline;
    } else {
      const rise = Math.max(0, Math.min(1, (t - 10)/(effPeak - 10)));
      const riseC = Math.pow(rise, 0.7);
      let decay = 1;
      if (t > effPeak) {
        decay = Math.max(0.4, 1 - Math.pow((t-effPeak)/120, 0.8));
      }
      conc = baseline + (maxConc - baseline) * riseC * decay;
    }
    pts.push({t, conc});
  }
  pts.forEach((p, i) => {
    const x = toX(p.t), y = toY(p.conc);
    if (i === 0) ctx.moveTo(x, y); else ctx.lineTo(x, y);
  });
  ctx.stroke();

  // Gradient fill
  const grad = ctx.createLinearGradient(0, pad.top, 0, pad.top+gh);
  grad.addColorStop(0, 'rgba(0,212,255,0.15)');
  grad.addColorStop(1, 'rgba(0,212,255,0)');
  ctx.fillStyle = grad;
  ctx.beginPath();
  pts.forEach((p, i) => {
    const x = toX(p.t), y = toY(p.conc);
    if (i === 0) ctx.moveTo(x, y); else ctx.lineTo(x, y);
  });
  ctx.lineTo(toX(totalTime), toY(20));
  ctx.lineTo(pad.left, toY(20));
  ctx.closePath();
  ctx.fill();

  // Race window ‚Äî vertical dashed lines (race might be at peakT ¬± 30 min)
  const raceStart = parseInt(document.getElementById('peakTime').value) - 20;
  const raceEnd = parseInt(document.getElementById('peakTime').value) + 20;
  ctx.strokeStyle = 'rgba(255,107,53,0.7)';
  ctx.lineWidth = 1.5;
  ctx.setLineDash([5,4]);
  [raceStart, raceEnd].forEach(t => {
    if (t > 0 && t < totalTime) {
      ctx.beginPath();
      ctx.moveTo(toX(t), pad.top);
      ctx.lineTo(toX(t), pad.top+gh);
      ctx.stroke();
    }
  });
  ctx.setLineDash([]);
  ctx.fillStyle = 'rgba(255,107,53,0.6)';
  ctx.font = '10px DM Mono';
  ctx.textAlign = 'center';
  ctx.fillText('Optimal race window', toX((raceStart+raceEnd)/2), pad.top + 14);

  // Peak marker
  const effPeakT = peakT * delayFactor;
  const peakX = toX(Math.min(effPeakT, totalTime-5));
  ctx.strokeStyle = 'rgba(0,212,255,0.4)';
  ctx.lineWidth = 1;
  ctx.beginPath();
  ctx.moveTo(peakX, pad.top+4);
  ctx.lineTo(peakX, pad.top+gh);
  ctx.stroke();
  ctx.fillStyle = 'rgba(0,212,255,0.9)';
  ctx.font = '10px DM Mono';
  ctx.textAlign = 'center';
  ctx.fillText('peak', peakX, pad.top - 4);
}

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
// LAYER 2 ‚Äî BLOOD pH
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
function updatepH() {
  const intensity = parseInt(document.getElementById('intensity').value);
  const duration = parseInt(document.getElementById('duration').value);
  document.getElementById('intensityVal').textContent = intensity + '%';
  const durationLabels = ['','1 min','2 min (200m)','3 min','4 min (400m)','5 min','6 min','7 min','8 min'];
  document.getElementById('durationVal').textContent = durationLabels[duration] || duration + ' min';

  // Estimate final pH values
  const fatigueRate = (intensity - 70) / 30; // 0-1
  const phDrop = 0.15 + fatigueRate * 0.25 + (duration/8) * 0.18;
  const phNoB = Math.max(6.90, 7.40 - phDrop);
  const phWithB = Math.min(7.40, phNoB + 0.06 + fatigueRate * 0.04);

  // Time above 7.10
  const advantage = Math.round((phWithB - phNoB) / 0.008 * 3);

  document.getElementById('phNoB').textContent = phNoB.toFixed(2);
  document.getElementById('phNoB').className = 'info-card-value ' + (phNoB < 7.10 ? 'danger' : '');
  document.getElementById('phWithB').textContent = phWithB.toFixed(2);
  document.getElementById('phWithB').className = 'info-card-value ' + (phWithB > 7.10 ? '' : 'orange');
  document.getElementById('timeAbove').textContent = '+' + Math.max(0, advantage) + ' sec';

  drawpH(intensity, duration, phNoB, phWithB);
}

function drawpH(intensity, duration, phNoB, phWithB) {
  const canvas = document.getElementById('phCanvas');
  resizeCanvas(canvas);
  const ctx = canvas.getContext('2d');
  const W = canvas.width, H = canvas.height;
  ctx.clearRect(0, 0, W, H);

  const pad = { top: 30, right: 30, bottom: 50, left: 55 };
  const gw = W - pad.left - pad.right;
  const gh = H - pad.top - pad.bottom;

  // Grid
  ctx.strokeStyle = 'rgba(255,255,255,0.05)';
  ctx.lineWidth = 1;
  for (let i = 0; i <= 5; i++) {
    const y = pad.top + (i/5)*gh;
    ctx.beginPath(); ctx.moveTo(pad.left, y); ctx.lineTo(pad.left+gw, y); ctx.stroke();
  }
  for (let i = 0; i <= 8; i++) {
    const x = pad.left + (i/8)*gw;
    ctx.beginPath(); ctx.moveTo(x, pad.top); ctx.lineTo(x, pad.top+gh); ctx.stroke();
  }

  const phMin = 6.85, phMax = 7.45;
  const toY = v => pad.top + gh - (v - phMin)/(phMax - phMin)*gh;
  const toX = t => pad.left + (t/duration)*gw;

  // Axis labels
  ctx.fillStyle = '#6b7d8f';
  ctx.font = '10px DM Mono';
  ctx.textAlign = 'right';
  [6.9, 7.0, 7.1, 7.2, 7.3, 7.4].forEach(v => {
    ctx.fillText(v.toFixed(1), pad.left-8, toY(v)+3);
  });
  ctx.textAlign = 'center';
  for (let i = 0; i <= 8; i++) {
    const t = i/8 * duration;
    ctx.fillText(t.toFixed(1)+'m', pad.left+(i/8)*gw, pad.top+gh+18);
  }
  ctx.save();
  ctx.translate(14, pad.top+gh/2);
  ctx.rotate(-Math.PI/2);
  ctx.fillStyle = '#9aacbc';
  ctx.font = '11px Instrument Sans';
  ctx.textAlign = 'center';
  ctx.fillText('Blood pH', 0, 0);
  ctx.restore();

  // Fatigue threshold line
  ctx.strokeStyle = 'rgba(255,211,42,0.5)';
  ctx.lineWidth = 1;
  ctx.setLineDash([6,4]);
  ctx.beginPath();
  ctx.moveTo(pad.left, toY(7.10));
  ctx.lineTo(pad.left+gw, toY(7.10));
  ctx.stroke();
  ctx.setLineDash([]);
  ctx.fillStyle = 'rgba(255,211,42,0.7)';
  ctx.font = '10px DM Mono';
  ctx.textAlign = 'left';
  ctx.fillText('fatigue threshold ~7.10', pad.left+6, toY(7.10)-5);

  // Generate curves
  const steps = 100;
  const fatigueRate = (parseInt(document.getElementById('intensity').value) - 70) / 30;

  function getPts(withBicarb) {
    const pts = [];
    for (let i = 0; i <= steps; i++) {
      const t = (i/steps)*duration;
      const progress = t/duration;
      const startPH = withBicarb ? 7.42 : 7.38;
      const endPH = withBicarb ? phWithB : phNoB;
      // S-curve decline
      const drop = 1 / (1 + Math.exp(-8*(progress - 0.4)));
      const ph = startPH - (startPH - endPH) * drop;
      pts.push({t, ph});
    }
    return pts;
  }

  // No bicarb ‚Äî red
  const ptsNo = getPts(false);
  ctx.strokeStyle = 'rgba(255,71,87,0.9)';
  ctx.lineWidth = 2;
  ctx.beginPath();
  ptsNo.forEach((p,i) => {
    if (i===0) ctx.moveTo(toX(p.t), toY(p.ph));
    else ctx.lineTo(toX(p.t), toY(p.ph));
  });
  ctx.stroke();

  // With bicarb ‚Äî cyan
  const ptsWith = getPts(true);
  ctx.strokeStyle = 'rgba(0,212,255,0.9)';
  ctx.lineWidth = 2.5;
  ctx.beginPath();
  ptsWith.forEach((p,i) => {
    if (i===0) ctx.moveTo(toX(p.t), toY(p.ph));
    else ctx.lineTo(toX(p.t), toY(p.ph));
  });
  ctx.stroke();

  // Gradient fill between curves
  const gradFill = ctx.createLinearGradient(0, 0, 0, H);
  gradFill.addColorStop(0, 'rgba(0,212,255,0.08)');
  gradFill.addColorStop(1, 'rgba(0,212,255,0.01)');
  ctx.fillStyle = gradFill;
  ctx.beginPath();
  ptsWith.forEach((p,i) => {
    if(i===0) ctx.moveTo(toX(p.t), toY(p.ph));
    else ctx.lineTo(toX(p.t), toY(p.ph));
  });
  for(let i=ptsNo.length-1; i>=0; i--) {
    ctx.lineTo(toX(ptsNo[i].t), toY(ptsNo[i].ph));
  }
  ctx.closePath();
  ctx.fill();
}

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
// LAYER 4 ‚Äî WESTERBLAD
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
let westActive = false;
function toggleWesterblad() {
  westActive = !westActive;
  const btn = document.getElementById('westBtn');
  const panel = document.getElementById('westPanel');
  if (westActive) {
    btn.textContent = 'Hide Westerblad challenge';
    btn.classList.add('active-purple');
    panel.classList.add('show');
  } else {
    btn.textContent = 'Show Westerblad challenge';
    btn.classList.remove('active-purple');
    panel.classList.remove('show');
  }
  drawWesterblad();
}

function drawWesterblad() {
  const canvas = document.getElementById('westCanvas');
  resizeCanvas(canvas);
  const ctx = canvas.getContext('2d');
  const W = canvas.width, H = canvas.height;
  ctx.clearRect(0, 0, W, H);

  const pad = { top: 30, right: 30, bottom: 50, left: 55 };
  const gw = W - pad.left - pad.right;
  const gh = H - pad.top - pad.bottom;

  ctx.strokeStyle = 'rgba(255,255,255,0.05)';
  ctx.lineWidth = 1;
  for (let i = 0; i <= 5; i++) {
    const y = pad.top + (i/5)*gh;
    ctx.beginPath(); ctx.moveTo(pad.left, y); ctx.lineTo(pad.left+gw, y); ctx.stroke();
  }
  for (let i = 0; i <= 8; i++) {
    const x = pad.left + (i/8)*gw;
    ctx.beginPath(); ctx.moveTo(x, pad.top); ctx.lineTo(x, pad.top+gh); ctx.stroke();
  }

  const steps = 100;
  const toX = t => pad.left + (t/steps)*gw;
  const toYNorm = (v, min, max) => pad.top + gh - (v-min)/(max-min)*gh;

  // H+ accumulation (normalized 0-1)
  const hpts = [];
  for (let i = 0; i <= steps; i++) {
    const t = i/steps;
    hpts.push(Math.pow(t, 0.8));
  }

  ctx.strokeStyle = 'rgba(0,212,255,0.85)';
  ctx.lineWidth = 2.5;
  ctx.beginPath();
  hpts.forEach((v,i) => {
    const x = toX(i);
    const y = toYNorm(v, 0, 1.2);
    if (i===0) ctx.moveTo(x, y); else ctx.lineTo(x, y);
  });
  ctx.stroke();

  if (westActive) {
    // Pi accumulation
    const pipts = [];
    for (let i = 0; i <= steps; i++) {
      const t = i/steps;
      pipts.push(Math.pow(t, 0.65) * 1.1);
    }
    ctx.strokeStyle = 'rgba(192,132,252,0.85)';
    ctx.lineWidth = 2.5;
    ctx.beginPath();
    pipts.forEach((v,i) => {
      const x = toX(i);
      const y = toYNorm(v, 0, 1.2);
      if (i===0) ctx.moveTo(x, y); else ctx.lineTo(x, y);
    });
    ctx.stroke();

    // Ca2+ transient decline
    const capts = [];
    for (let i = 0; i <= steps; i++) {
      const t = i/steps;
      capts.push(1.0 - Math.pow(t, 0.7) * 0.85);
    }
    ctx.strokeStyle = 'rgba(255,107,53,0.85)';
    ctx.lineWidth = 2;
    ctx.setLineDash([4,3]);
    ctx.beginPath();
    capts.forEach((v,i) => {
      const x = toX(i);
      const y = toYNorm(v, 0, 1.2);
      if (i===0) ctx.moveTo(x, y); else ctx.lineTo(x, y);
    });
    ctx.stroke();
    ctx.setLineDash([]);

    // annotation
    ctx.fillStyle = 'rgba(192,132,252,0.8)';
    ctx.font = '11px DM Mono';
    ctx.textAlign = 'right';
    ctx.fillText('[Pi] rivals H‚Å∫ as fatigue driver', pad.left+gw-4, pad.top+30);
    ctx.fillStyle = 'rgba(255,107,53,0.8)';
    ctx.fillText('Ca¬≤‚Å∫ decline ‚Äî SR Pi precipitation', pad.left+gw-4, pad.top+48);
  }

  // Axis labels
  ctx.fillStyle = '#6b7d8f';
  ctx.font = '10px DM Mono';
  ctx.textAlign = 'center';
  ['0%', '12%', '25%', '37%', '50%', '62%', '75%', '87%', '100%'].forEach((v,i) => {
    ctx.fillText(v, toX(i*100/8), pad.top+gh+18);
  });
  ctx.fillText('% of race duration ‚Üí', pad.left+gw/2, H-5);
  ctx.save();
  ctx.translate(14, pad.top+gh/2);
  ctx.rotate(-Math.PI/2);
  ctx.fillStyle = '#9aacbc';
  ctx.font = '11px Instrument Sans';
  ctx.textAlign = 'center';
  ctx.fillText('Normalized signal (a.u.)', 0, 0);
  ctx.restore();
}

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
// MODEL 2 ‚Äî RACE SIMULATION
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
const EVENT_DATA = {
  '200free': {
    laps: [
      { label: '50m (1)', stroke: 'Freestyle', mechanism: 'PCr + glycolysis onset, blood pH stable ~7.38' },
      { label: '50m (2)', stroke: 'Freestyle', mechanism: 'Glycolytic flux rising, H‚Å∫ beginning to build' },
      { label: '50m (3)', stroke: 'Freestyle', mechanism: 'H‚Å∫ buffering critical ‚Äî main NaHCO‚ÇÉ window' },
      { label: '50m (4)', stroke: 'Freestyle', mechanism: 'Fatigue resistance determines final push' },
    ],
    baseSplits: [26.0, 28.5, 30.2, 31.8],
    bicarBenefit: [0, 0.05, 0.45, 0.72],
  },
  '400free': {
    laps: [
      { label: '50m (1)', stroke: 'Freestyle', mechanism: 'Aerobic onset, PCr contribution, pH stable' },
      { label: '50m (2)', stroke: 'Freestyle', mechanism: 'Glycolysis ramping, lactate beginning to rise' },
      { label: '50m (3)', stroke: 'Freestyle', mechanism: 'H‚Å∫ buffering engaged ‚Äî NaHCO‚ÇÉ begins working' },
      { label: '50m (4)', stroke: 'Freestyle', mechanism: 'Critical window: buffering advantage widens' },
      { label: '50m (5)', stroke: 'Freestyle', mechanism: 'Lactate plateau ‚Äî buffering difference maximal' },
      { label: '50m (6)', stroke: 'Freestyle', mechanism: 'Fatigue acceleration without bicarb' },
      { label: '50m (7)', stroke: 'Freestyle', mechanism: 'Final approach ‚Äî accumulated H‚Å∫ advantage clear' },
      { label: '50m (8)', stroke: 'Freestyle', mechanism: 'Sprint finish ‚Äî H‚Å∫ tolerance determines output' },
    ],
    baseSplits: [29.2, 31.0, 31.8, 32.2, 32.6, 33.0, 32.8, 33.2],
    bicarBenefit: [0, 0.03, 0.15, 0.25, 0.35, 0.45, 0.42, 0.35],
  },
  '200im': {
    laps: [
      { label: '50m Fly', stroke: 'Butterfly', mechanism: 'Fly ‚Äî high demand, PCr dominant, pH stable' },
      { label: '50m Back', stroke: 'Backstroke', mechanism: 'Back ‚Äî lactate rising, H‚Å∫ beginning to accumulate' },
      { label: '50m Breast', stroke: 'Breaststroke', mechanism: 'Breast ‚Äî H‚Å∫ peaks, bicarb buffering maximally active' },
      { label: '50m Free', stroke: 'Freestyle', mechanism: 'Free finish ‚Äî H‚Å∫ tolerance determines final time' },
    ],
    baseSplits: [27.5, 32.5, 38.0, 29.5],
    bicarBenefit: [0, 0.12, 0.60, 0.45],
  },
};

let raceState = 'idle'; // idle | running | done
let raceInterval = null;
let currentLap = 0;
let raceData = null;

function updateAthlete() {
  const bw = parseInt(document.getElementById('bw').value);
  const vo2 = parseInt(document.getElementById('vo2').value);
  const tage = parseInt(document.getElementById('tage').value);
  const gitol = document.getElementById('gitol').value;
  const indiv = document.getElementById('indiv').value;

  document.getElementById('bwVal').textContent = bw + ' kg';
  document.getElementById('vo2Val').textContent = vo2 + ' ml/kg/min';
  document.getElementById('tageVal').textContent = tage + ' years elite';

  const dose = (bw * 0.3).toFixed(1);
  document.getElementById('chipDose').textContent = dose + 'g';

  // Expected gain: elite swimmers with more training age have higher buffering ‚Üí less benefit
  const baseGain = 1.4;
  const eliteReduction = Math.max(0, (tage - 4) * 0.05);
  const vo2Factor = vo2 > 72 ? 0.9 : 1.0;
  const gain = Math.max(0.5, (baseGain - eliteReduction) * vo2Factor);
  document.getElementById('chipGain').textContent = '~' + gain.toFixed(1) + '%';

  const giMap = { good: { label: 'Low', cls: 'green' }, moderate: { label: 'Moderate', cls: 'orange' }, poor: { label: 'High', cls: 'danger' } };
  const gi = giMap[gitol];
  const giChip = document.getElementById('chipGI');
  giChip.textContent = gi.label;
  giChip.className = 'stat-chip-val ' + gi.cls;

  const buffLabel = tage >= 10 ? 'Highly trained' : tage >= 6 ? 'High trained' : 'Developing';
  document.getElementById('chipBuff').textContent = buffLabel;

  // GI warning
  const warning = document.getElementById('giWarning');
  const warningText = document.getElementById('giWarningText');
  if (gitol === 'poor' && indiv === 'no') {
    warning.style.display = 'block';
    warningText.textContent = 'High GI risk + first-time use = race day catastrophe risk. This is exactly the scenario Bob Bowman describes: "He ran to the bathroom before the 200 free final." Do not deploy bicarbonate in competition without individualized timing trials. The simulation below shows potential benefit ‚Äî in practice, this athlete has substantial probability of GI failure that eliminates any gain.';
  } else if (gitol === 'poor') {
    warning.style.display = 'block';
    warningText.textContent = 'Poor GI tolerance even with trialling. Consider enteric-coated capsules and split dosing. Benefits shown are theoretical maximums ‚Äî actual race benefit may be significantly reduced or eliminated by GI distress.';
  } else if (indiv === 'no') {
    warning.style.display = 'block';
    warningText.textContent = 'No individualized timing trials completed. Bowman\'s "dart throw" scenario. Benefits are statistical averages ‚Äî this athlete\'s actual time-to-peak is unknown and could mean competing in a declining alkalotic state.';
  } else {
    warning.style.display = 'none';
  }
}

function resetRace() {
  raceState = 'idle';
  currentLap = 0;
  if (raceInterval) { clearInterval(raceInterval); raceInterval = null; }
  const btn = document.getElementById('activateBtn');
  btn.className = 'activate-btn';
  document.getElementById('btnDot').style.background = 'var(--accent)';
  document.getElementById('btnText').textContent = '‚ö° ACTIVATE NaHCO‚ÇÉ ‚Äî RUN RACE SIMULATION';
  document.getElementById('finalStats').style.display = 'none';
  buildLapTable();
  clearRaceCanvas();
}

function buildLapTable() {
  const event = document.getElementById('event').value;
  const data = EVENT_DATA[event];
  const laps = data.laps;
  const tbody = document.getElementById('lapBody');
  tbody.innerHTML = laps.map((lap, i) => `
    <tr id="lapRow${i}">
      <td>${lap.label}</td>
      <td>${lap.stroke}</td>
      <td class="time-no" id="splitNo${i}">‚Äî</td>
      <td class="time-yes" id="splitYes${i}">‚Äî</td>
      <td class="diff-zero" id="splitDiff${i}">‚Äî</td>
      <td style="font-size:11px; color:var(--text-dim)">${lap.mechanism}</td>
    </tr>
  `).join('');
}

function clearRaceCanvas() {
  const canvas = document.getElementById('racePhCanvas');
  resizeCanvas(canvas);
  const ctx = canvas.getContext('2d');
  ctx.clearRect(0, 0, canvas.width, canvas.height);
  drawRaceAxes(ctx, canvas.width, canvas.height, 0);
}

function drawRaceAxes(ctx, W, H, nLaps) {
  const pad = { top: 24, right: 24, bottom: 44, left: 50 };
  const gw = W - pad.left - pad.right;
  const gh = H - pad.top - pad.bottom;

  ctx.strokeStyle = 'rgba(255,255,255,0.05)';
  ctx.lineWidth = 1;
  for (let i = 0; i <= 5; i++) {
    const y = pad.top + (i/5)*gh;
    ctx.beginPath(); ctx.moveTo(pad.left, y); ctx.lineTo(pad.left+gw, y); ctx.stroke();
  }

  // Axis labels
  ctx.fillStyle = '#6b7d8f';
  ctx.font = '10px DM Mono';
  ctx.textAlign = 'right';
  const phVals = [6.95, 7.05, 7.15, 7.25, 7.35];
  phVals.forEach(v => {
    const y = pad.top + gh - (v-6.9)/(7.45-6.9)*gh;
    ctx.fillText(v.toFixed(2), pad.left-6, y+3);
  });

  // Right axis: lactate scale
  ctx.fillStyle = 'rgba(255,211,42,0.6)';
  ctx.textAlign = 'left';
  [0, 5, 10, 15, 20].forEach(v => {
    const y = pad.top + gh - (v/24)*gh;
    ctx.fillText(v, W-pad.right+6, y+3);
  });

  ctx.fillStyle = '#9aacbc';
  ctx.textAlign = 'center';
  ctx.font = '11px Instrument Sans';
  ctx.fillText('Lap ‚Üí', pad.left+gw/2, H-5);
  ctx.save();
  ctx.translate(13, pad.top+gh/2);
  ctx.rotate(-Math.PI/2);
  ctx.fillText('pH', 0, 0);
  ctx.restore();
  ctx.save();
  ctx.translate(W-10, pad.top+gh/2);
  ctx.rotate(-Math.PI/2);
  ctx.fillStyle = 'rgba(255,211,42,0.7)';
  ctx.fillText('Lactate mmol/L', 0, 0);
  ctx.restore();
}

function startRace() {
  if (raceState === 'running') return;

  raceState = 'running';
  currentLap = 0;

  const btn = document.getElementById('activateBtn');
  btn.className = 'activate-btn running';
  document.getElementById('btnText').textContent = '‚ñ∂ SIMULATING RACE...';
  document.getElementById('finalStats').style.display = 'none';

  const event = document.getElementById('event').value;
  const bw = parseInt(document.getElementById('bw').value);
  const tage = parseInt(document.getElementById('tage').value);
  const vo2 = parseInt(document.getElementById('vo2').value);
  const gitol = document.getElementById('gitol').value;
  const indiv = document.getElementById('indiv').value;

  const baseGain = 1.4;
  const eliteReduction = Math.max(0, (tage - 4) * 0.05);
  const vo2Factor = vo2 > 72 ? 0.9 : 1.0;
  const gainPct = Math.max(0.5, (baseGain - eliteReduction) * vo2Factor);

  // GI penalty
  let giPenalty = 0;
  if (gitol === 'poor' && indiv === 'no') giPenalty = 0.015;
  else if (gitol === 'poor') giPenalty = 0.005;
  else if (indiv === 'no') giPenalty = 0.005;

  const data = EVENT_DATA[event];
  const baseSplits = [...data.baseSplits];
  const benefits = [...data.bicarBenefit];

  // Adjust baseSplits by athlete profile (vo2, tage)
  const speedFactor = (0.8 + (vo2-55)/25 * 0.2) * (0.9 + tage/15*0.1);
  const adjustedBase = baseSplits.map(s => s / speedFactor);

  const withBicarb = adjustedBase.map((s, i) => {
    // benefit[i] is a weight (0‚Äì1); total gain is gainPct% of total race time, distributed by weight
    const totalBase = adjustedBase.reduce((a,b) => a+b, 0);
    const totalSaving = totalBase * (gainPct / 100);
    const totalWeight = benefits.reduce((a,b) => a+b, 0) || 1;
    const lapSaving = totalSaving * (benefits[i] / totalWeight);
    const penalised = s + (giPenalty * s); // GI penalty adds time
    return penalised - lapSaving;
  });

  // Pre-compute physiology
  const nLaps = adjustedBase.length;
  function phCurve(withB) {
    return adjustedBase.map((_, i) => {
      const prog = i / (nLaps - 1);
      const start = withB ? 7.42 : 7.38;
      const end = withB ? 7.12 : 7.05;
      return start - (start-end) * Math.pow(prog, 0.6);
    });
  }
  function lacCurve(withB) {
    return adjustedBase.map((_, i) => {
      const prog = (i+1)/nLaps;
      const peak = withB ? 14.5 : 12.8;
      return 2 + peak * Math.pow(prog, 0.7);
    });
  }

  const phNo = phCurve(false), phYes = phCurve(true);
  const lacNo = lacCurve(false), lacYes = lacCurve(true);

  raceData = { adjustedBase, withBicarb, phNo, phYes, lacNo, lacYes, nLaps };

  clearRaceCanvas();
  buildLapTable();

  raceInterval = setInterval(() => {
    if (currentLap >= nLaps) {
      clearInterval(raceInterval);
      raceInterval = null;
      raceState = 'done';

      const btn = document.getElementById('activateBtn');
      btn.className = 'activate-btn done';
      document.getElementById('btnText').textContent = '‚úì SIMULATION COMPLETE ‚Äî CLICK TO RESET';
      btn.onclick = () => { resetRace(); btn.onclick = startRace; };

      const totalNo = adjustedBase.reduce((a,b)=>a+b,0);
      const totalYes = withBicarb.reduce((a,b)=>a+b,0);
      const diff = totalNo - totalYes;
      const pct = (diff / totalNo * 100);

      document.getElementById('finalStats').style.display = 'flex';
      document.getElementById('finalNoB').textContent = fmtTime(totalNo);
      document.getElementById('finalWithB').textContent = fmtTime(totalYes);
      document.getElementById('finalDiff').textContent = diff.toFixed(2) + 's';
      document.getElementById('finalPct').textContent = pct.toFixed(2) + '%';
      document.getElementById('finalLacNo').textContent = lacNo[nLaps-1].toFixed(1) + ' mmol/L';
      document.getElementById('finalLacYes').textContent = lacYes[nLaps-1].toFixed(1) + ' mmol/L';
      return;
    }

    const i = currentLap;

    // Update lap table row
    const rowEl = document.getElementById('lapRow' + i);
    if (rowEl) rowEl.classList.add('active');

    document.getElementById('splitNo' + i).textContent = fmtTime(adjustedBase[i]);
    document.getElementById('splitYes' + i).textContent = fmtTime(withBicarb[i]);
    const diff = adjustedBase[i] - withBicarb[i];
    const diffEl = document.getElementById('splitDiff' + i);
    if (diff > 0.02) {
      diffEl.textContent = '‚àí' + diff.toFixed(2) + 's';
      diffEl.className = 'diff-pos';
    } else if (diff < -0.02) {
      diffEl.textContent = '+' + Math.abs(diff).toFixed(2) + 's';
      diffEl.className = 'diff-neg';
    } else {
      diffEl.textContent = '‚âà 0';
      diffEl.className = 'diff-zero';
    }

    // Draw progressive race canvas
    drawRaceProgress(i+1);
    currentLap++;
  }, 600);
}

function drawRaceProgress(revealedLaps) {
  const canvas = document.getElementById('racePhCanvas');
  resizeCanvas(canvas);
  const ctx = canvas.getContext('2d');
  const W = canvas.width, H = canvas.height;
  ctx.clearRect(0, 0, W, H);

  if (!raceData) return;

  const { phNo, phYes, lacNo, lacYes, nLaps } = raceData;
  const pad = { top: 24, right: 50, bottom: 44, left: 50 };
  const gw = W - pad.left - pad.right;
  const gh = H - pad.top - pad.bottom;

  drawRaceAxes(ctx, W, H, nLaps);

  const toX = i => pad.left + (i/(nLaps-1 || 1)) * gw;
  const toYpH = v => pad.top + gh - (v-6.9)/(7.45-6.9)*gh;
  const toYLac = v => pad.top + gh - (v/24)*gh;

  // Lap tick marks
  ctx.strokeStyle = 'rgba(255,255,255,0.08)';
  ctx.lineWidth = 1;
  for (let i = 0; i < nLaps; i++) {
    const x = toX(i);
    ctx.beginPath(); ctx.moveTo(x, pad.top+gh); ctx.lineTo(x, pad.top+gh+6); ctx.stroke();
    ctx.fillStyle = '#6b7d8f';
    ctx.font = '9px DM Mono';
    ctx.textAlign = 'center';
    ctx.fillText((i+1), x, pad.top+gh+18);
  }

  const n = Math.min(revealedLaps, nLaps);

  // Lactate ‚Äî no bicarb
  if (n >= 2) {
    ctx.strokeStyle = 'rgba(255,211,42,0.6)';
    ctx.lineWidth = 1.5;
    ctx.setLineDash([4,3]);
    ctx.beginPath();
    for (let i = 0; i < n; i++) {
      if (i===0) ctx.moveTo(toX(i), toYLac(lacNo[i])); else ctx.lineTo(toX(i), toYLac(lacNo[i]));
    }
    ctx.stroke();
    ctx.setLineDash([]);
  }

  // Lactate ‚Äî with bicarb
  if (n >= 2) {
    ctx.strokeStyle = 'rgba(168,255,120,0.6)';
    ctx.lineWidth = 1.5;
    ctx.setLineDash([4,3]);
    ctx.beginPath();
    for (let i = 0; i < n; i++) {
      if (i===0) ctx.moveTo(toX(i), toYLac(lacYes[i])); else ctx.lineTo(toX(i), toYLac(lacYes[i]));
    }
    ctx.stroke();
    ctx.setLineDash([]);
  }

  // pH ‚Äî no bicarb (red)
  ctx.strokeStyle = 'rgba(255,71,87,0.85)';
  ctx.lineWidth = 2;
  ctx.beginPath();
  for (let i = 0; i < n; i++) {
    if (i===0) ctx.moveTo(toX(i), toYpH(phNo[i])); else ctx.lineTo(toX(i), toYpH(phNo[i]));
  }
  ctx.stroke();

  // pH ‚Äî with bicarb (cyan)
  ctx.strokeStyle = 'rgba(0,212,255,0.9)';
  ctx.lineWidth = 2.5;
  ctx.beginPath();
  for (let i = 0; i < n; i++) {
    if (i===0) ctx.moveTo(toX(i), toYpH(phYes[i])); else ctx.lineTo(toX(i), toYpH(phYes[i]));
  }
  ctx.stroke();

  // Data points
  for (let i = 0; i < n; i++) {
    // pH dots
    ctx.fillStyle = i === n-1 ? 'rgba(255,71,87,1)' : 'rgba(255,71,87,0.6)';
    ctx.beginPath(); ctx.arc(toX(i), toYpH(phNo[i]), i===n-1?5:3, 0, Math.PI*2); ctx.fill();
    ctx.fillStyle = i === n-1 ? 'rgba(0,212,255,1)' : 'rgba(0,212,255,0.6)';
    ctx.beginPath(); ctx.arc(toX(i), toYpH(phYes[i]), i===n-1?5:3, 0, Math.PI*2); ctx.fill();
  }

  // Fatigue threshold
  ctx.strokeStyle = 'rgba(255,211,42,0.35)';
  ctx.lineWidth = 1;
  ctx.setLineDash([5,4]);
  ctx.beginPath();
  ctx.moveTo(pad.left, toYpH(7.10));
  ctx.lineTo(pad.left+gw, toYpH(7.10));
  ctx.stroke();
  ctx.setLineDash([]);
}

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
// INIT
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
// Models init deferred until Models tab is opened (see showSection)

window.addEventListener('resize', () => {
  if (!window._modelsInitDone) return;
  updateAbsorption();
  updatepH();
  drawWesterblad();
  if (raceData) drawRaceProgress(currentLap);
  else clearRaceCanvas();
});
</script>
</body>
</html>
